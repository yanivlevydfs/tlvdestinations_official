{% extends "base.html" %}
{% block head %}
<link rel="canonical" href="https://fly-tlv.com/flights" />
<link rel="alternate" hreflang="en" href="https://fly-tlv.com/flights" />
<link rel="alternate" hreflang="he" href="https://fly-tlv.com/flights?lang=he" />
<link rel="stylesheet" href="{{ url_for('static', path='css/app.css') }}?v={{ time.time() }}">
<!-- DataTables Responsive CSS -->
<link rel="stylesheet"
      href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">

<!-- DataTables Responsive JS -->
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>


  <!-- âœ… Page-specific SEO -->
  <meta name="description" content="Live flight statistics from Ben Gurion Airport (TLV). Explore the top destinations, airlines, countries, and cities with departures and arrivals updated in real-time.">
  <meta name="keywords" content="Ben Gurion Airport, TLV flights, flight statistics, top destinations, airlines, arrivals, departures, Tel Aviv flights">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
  <meta property="og:description" content="See live statistics from Ben Gurion Airport (TLV). Explore top countries, cities, and airlines for departures and arrivals.">
  <meta property="og:url" content="https://fly-tlv.com/flights">
  <meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta property="og:image:alt" content="Ben Gurion Airport TLV statistics dashboard">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
  <meta name="twitter:description" content="Live departures and arrivals statistics from TLV airport. Updated charts with top destinations and airlines.">
  <meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta name="twitter:image:alt" content="TLV airport stats overview">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [

    {
      "@type": "Organization",
      "@id": "https://fly-tlv.com/#organization",
      "name": "Fly TLV",
      "url": "https://fly-tlv.com/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://fly-tlv.com/static/icons/favicon-512.png",
        "width": 512,
        "height": 512
      },
      "sameAs": [
        "https://www.facebook.com/flytlv",
        "https://www.instagram.com/flytlv",
        "https://www.linkedin.com/company/flytlv"
      ]
    },

    {
      "@type": "WebSite",
      "@id": "https://fly-tlv.com/#website",
      "url": "https://fly-tlv.com/",
      "name": "Fly TLV â€” Direct Destinations from Tel Aviv",
      "publisher": { "@id": "https://fly-tlv.com/#organization" },
      "inLanguage": "en-US",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://fly-tlv.com/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    },

    {
      "@type": "WebPage",
      "@id": "https://fly-tlv.com/flights#webpage",
      "url": "https://fly-tlv.com/flights",
      "name": "Flights from Tel Aviv â€” Fly TLV",
      "description": "Scheduled and direct flights from Tel Aviv Ben Gurion Airport (TLV).",
      "inLanguage": "en-US",
      "isPartOf": { "@id": "https://fly-tlv.com/#website" },
      "alternateLanguage": "https://fly-tlv.com/flights?lang=he",
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://fly-tlv.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Flights",
            "item": "https://fly-tlv.com/flights"
          }
        ]
      }
    }

  ]
}
</script>

{% endblock %}
{% block content %}

<!-- Hero Section -->
<div class="hero-section text-center py-5 shadow-sm mb-4" lang="{{ lang }}" dir="{{ 'rtl' if lang == 'he' else 'ltr' }}">
  <div class="container position-relative z-1">
    <h1 class="fw-bold mb-2">
      <i class="bi bi-airplane-engines me-2"></i>
      {{ 'Ben Gurion Airport Flight Schedule' if lang != 'he' else '×œ×•×— ×˜×™×¡×•×ª â€” × ××œ ×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ' }}
    </h1>
    <div class="last-update-badge mt-2 d-inline-flex align-items-center">
      <i class="bi bi-clock-history"></i>
      {{ 'Last update:' if lang != 'he' else '×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:' }}
      <strong>{{ last_update }}</strong>
    </div>
  </div>
</div>

<div class="container-fluid px-3 px-lg-5" lang="{{ lang }}" dir="{{ 'rtl' if lang == 'he' else 'ltr' }}">
  <!-- Main Glass Card -->
  <div class="card shadow-sm p-0 overflow-hidden">
    <div class="card-body p-2 p-md-3">
      <div class="table-responsive">
        <table id="flightsTable" class="styled-table display table table-bordered table-hover w-100">
          <thead class="table-primary">
            <tr>
              <th></th> <!-- âœ… Responsive control column -->
              <th scope="col">{{ 'Airline' if lang != 'he' else '×—×‘×¨×ª ×ª×¢×•×¤×”' }}</th>
              <th scope="col">IATA</th>
              <th scope="col">{{ 'Airport' if lang != 'he' else '×©×“×” ×ª×¢×•×¤×”' }}</th>
              <th scope="col">{{ 'City' if lang != 'he' else '×¢×™×¨' }}</th>
              <th scope="col">{{ 'Country' if lang != 'he' else '××“×™× ×”' }}</th>
              <th scope="col">{{ 'Scheduled' if lang != 'he' else '××ª×•×›× × ×ª' }}</th>
              <th scope="col">{{ 'Actual' if lang != 'he' else '×©×¢×ª × ×—×™×ª×”/×”××¨××”' }}</th>
              <th scope="col">{{ 'Terminal' if lang != 'he' else '×˜×¨××™× ×œ' }}</th>
              <th scope="col">{{ 'Direction' if lang != 'he' else '×›×™×•×•×Ÿ' }}</th>
              <th scope="col">{{ 'Status' if lang != 'he' else '×¡×˜×˜×•×¡' }}</th>
            </tr>
          </thead>
          <tbody>
            {% for flight in flights %}
            <tr>
              <td class="dtr-control"></td>
              <td class="airline-cell">
                {% if flight.airline and flight.airline != "â€”" %}
                {% for airline in flight.airline.split(',') %}
                  {% set airline_name = airline.strip().title() %}
                  {% set website = AIRLINE_WEBSITES.get(airline_name) %}
                  {% if website %}
                  <a
                    href="{{ website }}"
                    target="_blank"
                    rel="noopener"
                    class="airline-chip text-decoration-none fw-semibold"
                    title="Visit {{ airline_name | e }} website"
                  >
                    {{ airline_name }}
                    <i class="bi bi-box-arrow-up-right ms-1" style="font-size: 0.85em;"></i>
                  </a>
                  {% else %}
                  <a
                    href="https://www.google.com/search?q={{ airline_name | urlencode }}"
                    target="_blank"
                    rel="noopener"
                    class="airline-chip text-decoration-none fw-semibold"
                    title="Search for {{ airline_name | e }} on Google"
                  >
                    {{ airline_name }}
                    <i class="bi bi-search ms-1" style="font-size: 0.85em;"></i>
                  </a>
                  {% endif %}
                {% endfor %}
                {% else %}
                â€”
                {% endif %}
              </td>
              <td>{{ flight.iata }}</td>
              <td>{{ flight.airport }}</td>
              <td><a href="/destinations/{{ flight.iata }}" class="text-decoration-none fw-bold">{{ flight.city }}</a></td>
              <td>{{ flight.country }}</td>
              <!-- Scheduled -->
              <td title="{{ flight.scheduled_full if flight.scheduled_full else '' }}">
                {% if flight.scheduled_full %}
                <time datetime="{{ flight.scheduled_full }}">{{ flight.scheduled }}</time>
                {% else %}
                â€”
                {% endif %}
              </td>

              <!-- Actual -->
              <td title="{{ flight.actual_full if flight.actual_full else '' }}">
                {% if flight.actual_iso %}
                <span class="d-none">{{ flight.actual_iso }}</span>  {# ğŸ‘ˆ this makes ISO searchable #}
                <time datetime="{{ flight.actual_iso }}">{{ flight.actual }}</time>
                {% else %}
                â€”
                {% endif %}
              </td>
              <td>
                {{ flight.terminal if flight.terminal else 'â€”' }}
              </td>
              <td>
                {% if flight.direction == "D" %}
                  <span class="flight-status-badge badge bg-primary"> {{ 'Departure' if lang != 'he' else '×”××¨××”' }} </span>
                {% elif flight.direction == "A" %}
                  <span class="flight-status-badge badge bg-success"> {{ 'Arrival' if lang != 'he' else '× ×—×™×ª×”' }} </span>
                {% else %} â€” {% endif %}
              </td>
              <td>
                {% set s = flight.status|lower %}
                {% if "on time" in s %}
                <span class="flight-status-badge badge bg-success">{{ 'On Time' if lang != 'he' else '×‘×–××Ÿ' }}</span>
                {% elif "delay" in s %}
                <span class="flight-status-badge badge bg-warning text-dark">{{ 'Delayed' if lang != 'he' else '×‘×¢×™×›×•×‘' }}</span>
                {% elif "cancel" in s %}
                <span class="flight-status-badge badge bg-danger">{{ 'Cancelled' if lang != 'he' else '×‘×•×˜×œ×”' }}</span>
                {% elif "not final" in s %}
                <span class="flight-status-badge badge bg-secondary text-white">{{ 'Not Final' if lang != 'he' else '×œ× ×¡×•×¤×™' }}</span>
                {% elif "landed" in s %}
                <span class="flight-status-badge badge bg-info text-dark">{{ 'Landed' if lang != 'he' else '× ×—×ª×”' }}</span>
                {% elif "departed" in s %}
                <span class="flight-status-badge badge bg-info text-dark">{{ 'Departed' if lang != 'he' else '×”××¨××”' }}</span>
                {% elif "boarding" in s %}
                <span class="flight-status-badge badge bg-primary text-white">{{ 'Boarding' if lang != 'he' else '×¢×œ×™×™×” ×œ××˜×•×¡' }}</span>
                {% elif "gate closed" in s %}
                <span class="flight-status-badge badge bg-secondary text-white">{{ 'Gate Closed' if lang != 'he' else '×©×¢×¨ × ×¡×’×¨' }}</span>
                {% elif "scheduled" in s %}
                <span class="flight-status-badge badge bg-light text-dark">{{ 'Scheduled' if lang != 'he' else '××ª×•×›× × ×ª' }}</span>
                {% elif "unknown" in s %}
                <span class="flight-status-badge badge bg-dark text-white">{{ 'Unknown' if lang != 'he' else '×œ× ×™×“×•×¢' }}</span>
                {% else %}
                <span class="flight-status-badge badge bg-info text-dark">{{ flight.status }}</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

  <!-- Kiwi / Travelpayouts Banner -->
  <div class="container-fluid px-2 px-md-3">
  <div class="card mt-4 shadow-sm" aria-label="Advertisement">
    <div class="card-header small text-muted fw-semibold">
      <i class="bi bi-airplane-engines me-1 text-primary"></i>Flight Search
    </div>
    <div class="card-body text-center">
      <script
        async
        src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.flight_bannerindex&show_hotels=true&powered_by=true&locale={{ 'he' if lang == 'he' else 'en' }}&searchUrl=www.aviasales.com%2Fsearch&primary_override=%2332a8dd&color_button=%2332a8dd&color_icons=%2332a8dd&dark=%23262626&light=%23FFFFFF&secondary=%23FFFFFF&special=%23C4C4C400&color_focused=%2332a8dd&border_radius=19&no_labels=true&plain=true&origin=TLV&promo_id=7879&campaign_id=100"
        charset="utf-8"
      ></script>
    </div>
  </div>
</div>

<div class="card shadow-sm d-none d-lg-block mt-4 mb-4 mx-3 mx-lg-5" aria-label="Advertisement">
  <div class="card-header small text-muted fw-semibold">
    <i class="bi bi-sim-fill me-1 text-primary"></i>{{ 'Travel SIM Deals' if lang != 'he' else '×¢×¡×§××•×ª ×¡×™× ×œ×—×•×´×œ' }}
  </div>
  <div class="card-body text-center p-0" style="overflow: hidden;">
    <script
      async
      src="https://tpembd.com/content?trs=461563&shmarker=674907.destinationsim&locale={{ 'he' if lang == 'he' else 'en' }}&powered_by=true&color_button=%2332a8dd&color_focused=%2332a8dd&secondary=%23FFFFFF&dark=%23262626&light=%23FFFFFF&special=%2300000000&border_radius=0&plain=false&no_labels=true&promo_id=8588&campaign_id=541"
      charset="utf-8">
      </script>
  </div>
</div>

<div class="container-fluid px-2 px-md-3 mb-5">
  <div class="card mt-3 shadow-sm" aria-label="Advertisement">
    <div class="card-header small text-muted fw-semibold">
      <i class="bi bi-airplane me-1 text-primary"></i>Flight Cancelled or Delayed?
    </div>
    <div class="card-body text-center p-0">
      <script
        async
        src="https://tpembd.com/content?trs=461563&shmarker=674907.airhelp_left_1&lang=en&powered_by=true&campaign_id=120&promo_id=8679"
        charset="utf-8"
      ></script>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}

<script>
$(document).ready(function () {
  const lang = "{{ lang }}";

  const dtButtons = lang === "he"
    ? [
        { extend: 'copyHtml5', text: '<i class="bi bi-clipboard me-1"></i> ×”×¢×ª×§' },
        { extend: 'csvHtml5', text: '<i class="bi bi-filetype-csv me-1"></i> CSV' },
        { extend: 'excelHtml5', text: '<i class="bi bi-file-earmark-excel me-1"></i> Excel' },
      ]
    : [
        { extend: 'copyHtml5', text: '<i class="bi bi-clipboard me-1"></i> Copy' },
        { extend: 'csvHtml5', text: '<i class="bi bi-filetype-csv me-1"></i> CSV' },
        { extend: 'excelHtml5', text: '<i class="bi bi-file-earmark-excel me-1"></i> Excel' },
      ];

  const table = $('#flightsTable').DataTable({
    dom:
      "<'row mb-3 align-items-center'<'col-12 col-md-auto dt-buttons'B><'col-12 col-md dt-filters'><'col-12 col-md-auto'f>>" +
      "<'row'<'col-12'tr>>" +
      "<'row mt-2'<'col-sm-12 col-md-6'i><'col-sm-12 col-md-6'p>>",
    buttons: dtButtons,
    pageLength: 25,
    responsive: {
      details: {
        type: 'column',
        target: 0
      }
    },
    
    order: [[6, 'asc']],
    pagingType: "simple",
    language: {
      url: lang === "he" ? "/static/js/lang.js" : "",
      infoFiltered: ""
    },
    columnDefs: [
    { targets: 0, className: 'dtr-control', orderable: false, searchable: false },

    { targets: 1, responsivePriority: 1 },   // Airline
    { targets: 10, responsivePriority: 1 },  // Status
    { targets: 8, responsivePriority: 2 },   // Terminal
    { targets: 6, responsivePriority: 2 },   // Scheduled
    { targets: 7, responsivePriority: 2 },   // Actual
    { targets: 9, responsivePriority: 3 },   // Direction

    { targets: [2, 3, 4, 5], responsivePriority: 100 }
], 

    initComplete: function () {

      // --- Style search input
      const infoElem = $('#flightsTable_info');
      // Re-use last-update-badge for the info pill if desired
      if (infoElem.length) infoElem.addClass('last-update-badge');

      const $searchWrapper = $('#flightsTable_filter');
      const $searchInput = $searchWrapper.find('input');
      const $searchLabel = $searchWrapper.find('label');

      $searchInput
        .attr('id', 'flights-search')
        .attr('placeholder', '{{ "Searchâ€¦" if lang != "he" else "×—×™×¤×•×©â€¦" }}')
        .addClass('form-control form-control-sm');

      $searchLabel.addClass('mb-0 d-flex align-items-center gap-2');
      $searchWrapper.addClass('mb-0 d-flex justify-content-center justify-content-md-end w-100');

      // --- Build filter UI
      $('.dt-filters').append(`
        <div class="d-none d-md-flex gap-3 flex-wrap align-items-center">
          <div class="d-flex align-items-center">
            <label for="direction-filter" class="me-2">{{ 'Direction' if lang != 'he' else '×›×™×•×•×Ÿ' }}</label>
            <select id="direction-filter" class="form-select form-select-sm">
              <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
              <option value="Departure">{{ 'Departure' if lang != 'he' else '×”××¨××”' }}</option>
              <option value="Arrival">{{ 'Arrival' if lang != 'he' else '× ×—×™×ª×”' }}</option>
            </select>
          </div>
          <div class="d-flex align-items-center">
            <label for="status-filter" class="me-2">{{ 'Status' if lang != 'he' else '×¡×˜×˜×•×¡' }}</label>
            <select id="status-filter" class="form-select form-select-sm">
              <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
              <option value="On Time">{{ 'On Time' if lang != 'he' else '×‘×–××Ÿ' }}</option>
              <option value="Delayed">{{ 'Delayed' if lang != 'he' else '×‘×¢×™×›×•×‘' }}</option>
              <option value="Cancelled">{{ 'Cancelled' if lang != 'he' else '×‘×•×˜×œ×”' }}</option>
              <option value="Not Final">{{ 'Not Final' if lang != 'he' else '×œ× ×¡×•×¤×™' }}</option>
            </select>
          </div>
          <div class="d-flex align-items-center">
            <label for="country-filter" class="me-2">{{ 'Country' if lang != 'he' else '××“×™× ×”' }}</label>
            <select id="country-filter" class="form-select form-select-sm">
              <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
              {% for country in countries %}
              <option value="{{ country }}">{{ country }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="d-flex align-items-center">
            <label for="actual-date-filter" class="me-2">{{ 'Actual Date' if lang != 'he' else '×ª××¨×™×š ×‘×¤×•×¢×œ' }}</label>
            <select id="actual-date-filter" class="form-select form-select-sm">
              <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
              {% for value, label in actual_dates %}
              <option value="{{ value }}">{{ label }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="d-flex align-items-center">
            <label for="actual-time-filter" class="me-2">{{ 'Actual Time' if lang != 'he' else '×©×¢×ª ×‘×¤×•×¢×œ' }}</label>
            <select id="actual-time-filter" class="form-select form-select-sm">
              <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
              {% for t in actual_times %}
              <option value="{{ t }}">{{ t }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="d-flex align-items-center">
              <label for="terminal-filter" class="me-2">
                {{ 'Terminal' if lang != 'he' else '×˜×¨××™× ×œ' }}
              </label>
              <select id="terminal-filter" class="form-select form-select-sm">
                <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
                {% for t in terminals %}
                  <option value="{{ t }}">{{ t }}</option>
                {% endfor %}
              </select>
            </div>
        </div>
        <div class="d-md-none">
          <div class="card mt-3">
            <div class="card-body d-flex flex-column gap-3">
              <div>
                <label for="flights-search-mobile" class="form-label mb-1 d-block">{{ 'Search' if lang != 'he' else '×—×™×¤×•×©' }}</label>
                <input type="search" id="flights-search-mobile" class="form-control form-control-sm w-100"
                       placeholder="{{ 'Searchâ€¦' if lang != 'he' else '×—×™×¤×•×©â€¦' }}">
              </div>
              <div>
                <label for="direction-filter-mobile" class="form-label">{{ 'Direction' if lang != 'he' else '×›×™×•×•×Ÿ' }}</label>
                <select id="direction-filter-mobile" class="form-select form-select-sm w-100">
                  <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
                  <option value="Departure">{{ 'Departure' if lang != 'he' else '×”××¨××”' }}</option>
                  <option value="Arrival">{{ 'Arrival' if lang != 'he' else '× ×—×™×ª×”' }}</option>
                </select>
              </div>
              <div>
                <label for="status-filter-mobile" class="form-label">{{ 'Status' if lang != 'he' else '×¡×˜×˜×•×¡' }}</label>
                <select id="status-filter-mobile" class="form-select form-select-sm w-100">
                  <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
                  <option value="On Time">{{ 'On Time' if lang != 'he' else '×‘×–××Ÿ' }}</option>
                  <option value="Delayed">{{ 'Delayed' if lang != 'he' else '×‘×¢×™×›×•×‘' }}</option>
                  <option value="Cancelled">{{ 'Cancelled' if lang != 'he' else '×‘×•×˜×œ×”' }}</option>
                  <option value="Not Final">{{ 'Not Final' if lang != 'he' else '×œ× ×¡×•×¤×™' }}</option>
                </select>
              </div>
              <div>
                <label for="country-filter-mobile" class="form-label">{{ 'Country' if lang != 'he' else '××“×™× ×”' }}</label>
                <select id="country-filter-mobile" class="form-select form-select-sm w-100">
                  <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
                  {% for country in countries %}
                  <option value="{{ country }}">{{ country }}</option>
                  {% endfor %}
                </select>
              </div>
              <div>
                <label for="actual-date-filter-mobile" class="form-label">{{ 'Actual Date' if lang != 'he' else '×ª××¨×™×š ×‘×¤×•×¢×œ' }}</label>
                <select id="actual-date-filter-mobile" class="form-select form-select-sm w-100">
                  <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
                  {% for value, label in actual_dates %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
              <div>
                  <label for="terminal-filter-mobile" class="form-label">
                    {{ 'Terminal' if lang != 'he' else '×˜×¨××™× ×œ' }}
                  </label>
                  <select id="terminal-filter-mobile" class="form-select form-select-sm w-100">
                    <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
                    {% for t in terminals %}
                      <option value="{{ t }}">{{ t }}</option>
                    {% endfor %}
                  </select>
                </div>
              <div>
                <label for="actual-time-filter-mobile" class="form-label">{{ 'Actual Time' if lang != 'he' else '×©×¢×ª ×‘×¤×•×¢×œ' }}</label>
                <select id="actual-time-filter-mobile" class="form-select form-select-sm w-100">
                  <option value="">{{ 'All' if lang != 'he' else '×”×›×œ' }}</option>
                  {% for t in actual_times %}
                  <option value="{{ t }}">{{ t }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>
        </div>
      `);

      $('.dt-filters .d-flex').first().append($searchWrapper);

      // Helper by header text
      const getColumnIndexByHeader = (headerText) => {
        let found = -1;
        $('#flightsTable thead th').each(function (i) {
          if ($(this).text().trim() === headerText.trim()) {
            found = i;
            return false;
          }
        });
        return found;
      };

      // âœˆ Filter handlers:
      $('#direction-filter, #direction-filter-mobile').on('change', function () {
        let sel = this.value;
        if (lang === "he" && sel) {
          sel = { "Departure":"×”××¨××”", "Arrival":"× ×—×™×ª×”" }[sel] || sel;
        }
        const idx = getColumnIndexByHeader("Direction");
        if (idx !== -1) table.column(idx).search(sel).draw();
      });

      $('#status-filter, #status-filter-mobile').on('change', function () {
        let sel = this.value;
        if (lang === "he" && sel) {
          sel = { "On Time":"×‘×–××Ÿ", "Delayed":"×‘×¢×™×›×•×‘", "Cancelled":"×‘×•×˜×œ×”", "Not Final":"×œ× ×¡×•×¤×™" }[sel] || sel;
        }
        const idx = getColumnIndexByHeader("Status");
        if (idx !== -1) table.column(idx).search(sel).draw();
      });

      $('#country-filter, #country-filter-mobile').on('change', function () {
        const idx = getColumnIndexByHeader("Country");
        if (idx !== -1) table.column(idx).search(this.value).draw();
      });

    $('#actual-date-filter, #actual-date-filter-mobile, #actual-time-filter, #actual-time-filter-mobile')
      .on('change', function () {

        const date =
          $('#actual-date-filter').val() ||
          $('#actual-date-filter-mobile').val();

        const time =
          $('#actual-time-filter').val() ||
          $('#actual-time-filter-mobile').val();

        // âœ… MUST be "Actual" column
        const idx = getColumnIndexByHeader(
          lang === "he" ? "×©×¢×ª × ×—×™×ª×”/×”××¨××”" : "Actual"
        );

        let regex = "";

        if (date && time) {
          regex = `^${date}T${time}`;
        } else if (date) {
          regex = `^${date}`;
        } else if (time) {
          regex = `${time}$`;
        }

        if (idx !== -1) {
          table.column(idx).search(regex, true, false).draw();
        }
    });


      $(document).on('input', '#flights-search-mobile', function () {
        table.search(this.value).draw();
      });
        $('#terminal-filter, #terminal-filter-mobile').on('change', function () {
      const val =
        $('#terminal-filter').val() ||
        $('#terminal-filter-mobile').val();

      const idx = getColumnIndexByHeader(
        lang === "he" ? "×˜×¨××™× ×œ" : "Terminal"
      );

      if (idx !== -1) {
        table.column(idx).search(val).draw();
      }
    });
    } // initComplete
  });

});
</script>


{% endblock %}

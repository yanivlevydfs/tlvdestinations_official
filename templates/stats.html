{% extends "base.html" %}

{% block title %}Ben Gurion Airport ‚Äî Current Flight Statistics{% endblock %}

{% block head %}
<!-- Canonical & hreflang for /stats -->
<link rel="canonical" href="https://fly-tlv.com/stats" />
<link rel="alternate" hreflang="en" href="https://fly-tlv.com/stats" />
<link rel="alternate" hreflang="he" href="https://fly-tlv.com/stats?lang=he" />
<link rel="alternate" hreflang="x-default" href="https://fly-tlv.com/stats" />

  <!-- ‚úÖ Page-specific SEO -->
  <meta name="description" content="Live flight statistics from Ben Gurion Airport (TLV). Explore the top destinations, airlines, countries, and cities with departures and arrivals updated in real-time.">
  <meta name="keywords" content="Ben Gurion Airport, TLV flights, flight statistics, top destinations, airlines, arrivals, departures, Tel Aviv flights">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Ben Gurion Airport ‚Äî Current Flight Statistics | Fly-TLV">
  <meta property="og:description" content="See live statistics from Ben Gurion Airport (TLV). Explore top countries, cities, and airlines for departures and arrivals.">
  <meta property="og:url" content="https://fly-tlv.com/stats">
  <meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_stats.jpg">
  <meta property="og:image:alt" content="Ben Gurion Airport TLV statistics dashboard">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ben Gurion Airport ‚Äî Current Flight Statistics | Fly-TLV">
  <meta name="twitter:description" content="Live departures and arrivals statistics from TLV airport. Updated charts with top destinations and airlines.">
  <meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta name="twitter:image:alt" content="TLV airport stats overview">

  <!-- Structured Data: Dataset -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Dataset",
    "name": "Ben Gurion Airport ‚Äî Current Flight Statistics",
    "description": "Live statistics of flights, departures, and arrivals from Ben Gurion Airport (TLV). Updated frequently with top destinations, airlines, and cities.",
    "url": "https://fly-tlv.com/stats",
    "license": "https://creativecommons.org/licenses/by/4.0/",
    "creator": {
      "@type": "Organization",
      "name": "Fly-TLV.com",
      "url": "https://fly-tlv.com"
    },
    "inLanguage": "{{ 'he-IL' if lang == 'he' else 'en-US' }}",
    "dateModified": "{{ last_update.isoformat() }}"
  }
  </script>
{% endblock %}

{% block content %}
<div class="container my-4">

  <!-- Title -->
  <h2 class="section-title text-center">
    üìä Ben Gurion Airport ‚Äî Current Flight Statistics
  </h2>
  <!-- Kiwi / Travelpayouts Banner -->
  <div class="card mt-3 shadow-sm" aria-label="Advertisement">
    <div class="card-header small text-muted fw-semibold">
      <i class="bi bi-airplane-engines me-1 text-primary"></i>Cheap Flights
    </div>
    <div class="card-body text-center">
      <script
        async
        src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.kiwi_banner&locale=en&stops=any&show_hotels=true&powered_by=true&border_radius=30&plain=true&color_button=%232563eb&color_button_text=%23ffffff&promo_id=3414&campaign_id=111"
        charset="utf-8"
      ></script>
    </div>
  </div>

  <!-- Last Update -->
  <div class="text-center mb-4">
    <span class="badge rounded-pill bg-info px-3 py-2 text-dark last-update-badge">
      Last Update: {{ last_update | datetimeformat }}
    </span>
  </div>

  <!-- Airline Filter -->
  <div class="row mb-4">
    <div class="col-12 col-md-6 offset-md-3">
      <label for="airline-filter" class="form-label fw-semibold">‚úàÔ∏è Filter by Airline</label>
      <select id="airline-filter" class="form-select">
        <option value="All">All Airlines</option>
        {% for airline in airlines %}
          <option value="{{ airline }}">{{ airline }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="row g-4">
    <!-- Top Countries -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header fw-bold">üåç Top Countries</div>
        <div class="card-body">
          <div class="table-responsive mb-3">
            <table id="countries-table" class="table table-striped table-hover table-sm align-middle text-center">
              <thead class="table-primary">
                <tr><th>Country</th><th>Departures</th><th>Arrivals</th></tr>
              </thead>
              <tbody>
                {% for row in top_countries %}
                <tr>
                  <td>{{ row.Country }}</td>
                  <td>{{ row.Departures }}</td>
                  <td>{{ row.Arrivals }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="countries-chart" style="height:320px;"></div>
        </div>
      </div>
    </div>

    <!-- Top Cities -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header fw-bold">üèôÔ∏è Top Cities</div>
        <div class="card-body">
          <div class="table-responsive mb-3">
            <table id="cities-table" class="table table-striped table-hover table-sm align-middle text-center">
              <thead class="table-primary">
                <tr><th>City</th><th>Departures</th><th>Arrivals</th></tr>
              </thead>
              <tbody>
                {% for row in top_cities %}
                <tr>
                  <td>{{ row.City }}</td>
                  <td>{{ row.Departures }}</td>
                  <td>{{ row.Arrivals }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="cities-chart" style="height:320px;"></div>
        </div>
      </div>
    </div>
  </div>
</div>
        <!-- Ads Under Table -->
        <div class="card mt-3 shadow-sm" aria-label="Advertisement">
          <div class="card-header small text-muted fw-semibold">
            <i class="bi bi-airplane-engines me-1 text-primary"></i> Flight Deals
          </div>
          <div class="card-body text-center p-0">
            <script
              async
              src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.kiwi_under_tb1&locale=en&powered_by=true&limit=4&primary_color=0049AEff&results_background_color=FFFFFF&form_background_color=FFFFFF&promo_id=4563&campaign_id=111"
              charset="utf-8"
            ></script>
          </div>
        </div>

        <div class="card mt-3 shadow-sm" aria-label="Advertisement">
          <div class="card-header small text-muted fw-semibold">
            <i class="bi bi-airplane me-1 text-primary"></i>Cheap ESIM
          </div>
          <div class="card-body text-center p=0">
            <script
              async
              src="https://tpembd.com/content?trs=461563&shmarker=674907.kiwi_under_tb2&locale=en&powered_by=true&color_button=%230049AE&color_focused=%230049AE&secondary=%23FFFFFF&dark=%2311100f&light=%23FFFFFF&special=%23C4C4C4&border_radius=30&plain=false&no_labels=true&promo_id=8588&campaign_id=541"
              charset="utf-8"
            ></script>
          </div>
        </div>

        <div class="card mt-3 shadow-sm" aria-label="Advertisement">
          <div class="card-header small text-muted fw-semibold">
            <i class="bi bi-airplane me-1 text-primary"></i>Flight Cancelled or Delayed?
          </div>
          <div class="card-body text-center p=0">
            <script
              async
              src="https://tpembd.com/content?trs=461563&shmarker=674907.airhelp_left_1&lang=en&powered_by=true&campaign_id=120&promo_id=8679"
              charset="utf-8"
            ></script>
          </div>
        </div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const airlinesData = {{ airlines_data | tojson }};
  const initialCountries = {{ top_countries | tojson }};
  const initialCities = {{ top_cities | tojson }};

  function renderCharts(countries, cities) {
    // Countries Chart
    Plotly.newPlot("countries-chart", [
      {
        x: countries.map(r => r.Country),
        y: countries.map(r => r.Departures),
        name: "Departures",
        type: "bar",
        marker: { color: "rgba(124,58,237,0.8)" }
      },
      {
        x: countries.map(r => r.Country),
        y: countries.map(r => r.Arrivals),
        name: "Arrivals",
        type: "bar",
        marker: { color: "rgba(34,211,238,0.8)" }
      }
    ], {
      barmode: "group",
      margin: { t: 30, r: 20, l: 40, b: 80 },
      legend: { orientation: "h", y: -0.3 },
    }, { responsive: true });

    // Cities Chart
    Plotly.newPlot("cities-chart", [
      {
        x: cities.map(r => r.City),
        y: cities.map(r => r.Departures),
        name: "Departures",
        type: "bar",
        marker: { color: "rgba(124,58,237,0.8)" }
      },
      {
        x: cities.map(r => r.City),
        y: cities.map(r => r.Arrivals),
        name: "Arrivals",
        type: "bar",
        marker: { color: "rgba(34,211,238,0.8)" }
      }
    ], {
      barmode: "group",
      margin: { t: 30, r: 20, l: 40, b: 80 },
      legend: { orientation: "h", y: -0.3 },
    }, { responsive: true });
  }

  // Initial render
  renderCharts(initialCountries, initialCities);

  // Airline filter
  document.getElementById("airline-filter").addEventListener("change", function () {
    const selected = this.value;
    const data = selected === "All" ? airlinesData["All"] : airlinesData[selected];
    renderCharts(data.countries, data.cities);

    // Update tables
    document.querySelector("#countries-table tbody").innerHTML =
      data.countries.map(r => `<tr><td>${r.Country}</td><td>${r.Departures}</td><td>${r.Arrivals}</td></tr>`).join("");

    document.querySelector("#cities-table tbody").innerHTML =
      data.cities.map(r => `<tr><td>${r.City}</td><td>${r.Departures}</td><td>${r.Arrivals}</td></tr>`).join("");
  });
});
</script>
{% endblock %}

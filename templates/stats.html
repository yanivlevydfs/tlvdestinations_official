{% extends "base.html" %}

{% block title %}Ben Gurion Airport â€” Current Flight Statistics{% endblock %}

{% block head %}
<!-- Canonical & hreflang for /stats -->
<link rel="canonical" href="https://fly-tlv.com/stats" />
<link rel="alternate" hreflang="en" href="https://fly-tlv.com/stats" />
<link rel="alternate" hreflang="he" href="https://fly-tlv.com/stats?lang=he" />
<link rel="stylesheet" href="{{ url_for('static', path='css/app.css') }}?v={{ time.time() }}">
  <!-- âœ… Page-specific SEO -->
  <meta name="description" content="Live flight statistics from Ben Gurion Airport (TLV). Explore the top destinations, airlines, countries, and cities with departures and arrivals updated in real-time.">
  <meta name="keywords" content="Ben Gurion Airport, TLV flights, flight statistics, top destinations, airlines, arrivals, departures, Tel Aviv flights">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
  <meta property="og:description" content="See live statistics from Ben Gurion Airport (TLV). Explore top countries, cities, and airlines for departures and arrivals.">
  <meta property="og:url" content="https://fly-tlv.com/stats">
  <meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta property="og:image:alt" content="Ben Gurion Airport TLV statistics dashboard">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
  <meta name="twitter:description" content="Live departures and arrivals statistics from TLV airport. Updated charts with top destinations and airlines.">
  <meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta name="twitter:image:alt" content="TLV airport stats overview">

  <!-- Structured Data: Dataset -->
<script type="application/ld+json">
[
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Fly TLV â€” Worldwide Destinations",
    "url": "https://fly-tlv.com/",
    "inLanguage": "en-US",
    "description": "Explore all destinations worldwide from Tel Aviv (TLV) with airlines, maps, distances, and travel data."
  },
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Fly TLV â€” ×›×œ ×”×™×¢×“×™× ××ª×œ ××‘×™×‘",
    "url": "https://fly-tlv.com/?lang=he",
    "inLanguage": "he-IL",
    "description": "×’×œ×” ××ª ×›×œ ×”×™×¢×“×™× ×‘×¢×•×œ× ××ª×œ ××‘×™×‘ (TLV): ×—×‘×¨×•×ª ×ª×¢×•×¤×”, ××¤×•×ª, ××¨×—×§×™× ×•× ×ª×•× ×™ ×˜×™×¡×”."
  },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Home", "url": "https://fly-tlv.com/" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "×‘×™×ª", "url": "https://fly-tlv.com/?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Stats", "url": "https://fly-tlv.com/stats" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "× ×ª×•× ×™ ×©×“×”", "url": "https://fly-tlv.com/stats?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Flights", "url": "https://fly-tlv.com/flights" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "×˜×™×¡×•×ª", "url": "https://fly-tlv.com/flights?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "World Map", "url": "https://fly-tlv.com/map" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "××¤×ª ×™×¢×“×™×", "url": "https://fly-tlv.com/map?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Travel Warnings", "url": "https://fly-tlv.com/travel-warnings" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "××–×”×¨×•×ª ××¡×¢", "url": "https://fly-tlv.com/travel-warnings?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Chat", "url": "https://fly-tlv.com/chat" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "×¦×³××˜", "url": "https://fly-tlv.com/chat?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "About", "url": "https://fly-tlv.com/about" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "×¢×œ×™× ×•", "url": "https://fly-tlv.com/about?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Direct vs Nonstop", "url": "https://fly-tlv.com/direct-vs-nonstop" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "×™×©×™×¨ ××•×œ ×œ×œ×-×¢×¦×™×¨×•×ª", "url": "https://fly-tlv.com/direct-vs-nonstop?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Glossary", "url": "https://fly-tlv.com/glossary" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "××™×œ×•×Ÿ ××•× ×—×™×", "url": "https://fly-tlv.com/glossary?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Privacy Policy", "url": "https://fly-tlv.com/privacy" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª", "url": "https://fly-tlv.com/privacy?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Accessibility", "url": "https://fly-tlv.com/accessibility" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "× ×’×™×©×•×ª", "url": "https://fly-tlv.com/accessibility?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Contact", "url": "https://fly-tlv.com/contact" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "×¦×•×¨ ×§×©×¨", "url": "https://fly-tlv.com/contact?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Sitemap", "url": "https://fly-tlv.com/sitemap.xml" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "××¤×ª ××ª×¨", "url": "https://fly-tlv.com/sitemap.xml?lang=he" }
]
</script>
{% endblock %}

{% block content %}
<div class="container my-4" lang="{{ lang }}" dir="{{ 'rtl' if lang == 'he' else 'ltr' }}">
  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item">
        <a href="/{{ '' if lang != 'he' else '?lang=he' }}">
          {{ 'Home' if lang != 'he' else '×‘×™×ª' }}
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ 'Statistics' if lang != 'he' else '×¡×˜×˜×™×¡×˜×™×§×•×ª' }}
      </li>
    </ol>
  </nav>
  <!-- Title -->
	<h2 class="section-title text-center">
		{% if lang == 'he' %}
		  ğŸ“Š × ×ª×•× ×™ ×˜×™×¡×•×ª ×¢×“×›× ×™×™× â€“ × ××œ ×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ
		{% else %}
		  ğŸ“Š Ben Gurion Airport â€” Current Flight Statistics
		{% endif %}
	  </h2>
  <!-- Kiwi / Travelpayouts Banner -->
  <div class="card mt-3 shadow-sm" aria-label="Advertisement">
    <div class="card-header small text-muted fw-semibold">
      <i class="bi bi-airplane-engines me-1 text-primary"></i>
      {% if lang == 'he' %} ×˜×™×¡×•×ª ×–×•×œ×•×ª {% else %} Cheap Flights {% endif %}
    </div>
    <div class="card-body text-center">
      <script
        async
        src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.kiwi_banner&locale=en&stops=any&show_hotels=true&powered_by=true&border_radius=30&plain=true&color_button=%232563eb&color_button_text=%23ffffff&promo_id=3414&campaign_id=111"
        charset="utf-8"
      ></script>
    </div>
  </div>

	<!-- Last Update -->
	<div class="text-center mb-4">
	  <span class="last-update-badge">
		<i class="bi bi-clock-history"></i>
		<span class="label-text">
        {% if lang == 'he' %}×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:{% else %}Last update:{% endif %}</span>
		<strong>{{ last_update | default('â€”') }}</strong>
	  </span>
	</div>


  <!-- Airline Filter -->
  <div class="row mb-4">
    <div class="col-12 col-md-6 offset-md-3">
    <label for="airline-filter" class="form-label fw-semibold">âœˆï¸ {% if lang == 'he' %}×¡×™× ×•×Ÿ ×œ×¤×™ ×—×‘×¨×ª ×ª×¢×•×¤×”{% else %}Filter by Airline{% endif %}</label>
      <select id="airline-filter" class="form-select">
        <option value="All">
          {% if lang == 'he' %}×›×œ ×”×—×‘×¨×•×ª{% else %}All Airlines{% endif %}
        </option>
        {% for airline in airlines %}<option value="{{ airline }}">{{ airline }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="row g-4">
    <!-- Top Countries -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header fw-bold">
          ğŸŒ {% if lang == 'he' %}×”××“×™× ×•×ª ×”××•×‘×™×œ×•×ª{% else %}Top Countries{% endif %}
        </div>
        <div class="card-body">
          <div class="table-responsive mb-3">
            <table id="countries-table" class="table table-striped table-hover table-sm align-middle text-center">
              <thead class="table-primary">
			    <tr>
               <th>{% if lang == 'he' %}××“×™× ×”{% else %}Country{% endif %}</th>
			   <th>{% if lang == 'he' %}×”××¨××•×ª{% else %}Departures{% endif %}</th>
			   <th>{% if lang == 'he' %}× ×—×™×ª×•×ª{% else %}Arrivals{% endif %}</th>
			    </tr>
              </thead>
              <tbody>
                {% for row in top_countries %}
                <tr>
                  <td>{{ row.Country }}</td>
                  <td>{{ row.Departures }}</td>
                  <td>{{ row.Arrivals }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="countries-chart" style="height:320px;"></div>
        </div>
      </div>
    </div>

    <!-- Top Cities -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
		<div class="card-header fw-bold">
		  ğŸ™ï¸ {% if lang == 'he' %}×”×¢×¨×™× ×”××•×‘×™×œ×•×ª{% else %}Top Cities{% endif %}
		</div>
        <div class="card-body">
          <div class="table-responsive mb-3">
            <table id="cities-table" class="table table-striped table-hover table-sm align-middle text-center">
              <thead class="table-primary">
              <th>{% if lang == 'he' %}×¢×™×¨{% else %}City{% endif %}</th>
              <th>{% if lang == 'he' %}×”××¨××•×ª{% else %}Departures{% endif %}</th>
              <th>{% if lang == 'he' %}× ×—×™×ª×•×ª{% else %}Arrivals{% endif %}</th>
              </thead>
              <tbody>
                {% for row in top_cities %}
                <tr>
                  <td>{{ row.City }}</td>
                  <td>{{ row.Departures }}</td>
                  <td>{{ row.Arrivals }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="cities-chart" style="height:320px;"></div>
        </div>
      </div>
    </div>
  </div>
</div>
        <!-- Ads Under Table -->
        <div class="card mt-3 shadow-sm" aria-label="Advertisement">
          <div class="card-header small text-muted fw-semibold">
            <i class="bi bi-airplane-engines me-1 text-primary"></i>
			{% if lang == 'he' %} ××‘×¦×¢×™× ×¢×œ ×˜×™×¡×•×ª {% else %} Flight Deals {% endif %}
          </div>
          <div class="card-body text-center p-0">
            <script
              async
              src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.kiwi_under_tb1&locale=en&powered_by=true&limit=4&primary_color=0049AEff&results_background_color=FFFFFF&form_background_color=FFFFFF&promo_id=4563&campaign_id=111"
              charset="utf-8"
            ></script>
          </div>
        </div>

        <div class="card mt-3 shadow-sm" aria-label="Advertisement">
          <div class="card-header small text-muted fw-semibold">
            <i class="bi bi-airplane me-1 text-primary"></i>
			{% if lang == 'he' %} ×¡×™× ×–×•×œ {% else %} Cheap ESIM {% endif %}
          </div>
          <div class="card-body text-center p-0">
            <script
              async
              src="https://tpembd.com/content?trs=461563&shmarker=674907.kiwi_under_tb2&locale=en&powered_by=true&color_button=%230049AE&color_focused=%230049AE&secondary=%23FFFFFF&dark=%2311100f&light=%23FFFFFF&special=%23C4C4C4&border_radius=30&plain=false&no_labels=true&promo_id=8588&campaign_id=541"
              charset="utf-8"
            ></script>
          </div>
        </div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const airlinesData = {{ airlines_data | tojson }};
  const initialCountries = {{ top_countries | tojson }};
  const initialCities = {{ top_cities | tojson }};

  function renderCharts(countries, cities) {
    // Countries Chart
    Plotly.newPlot("countries-chart", [
      {
        x: countries.map(r => r.Country),
        y: countries.map(r => r.Departures),
        name: "Departures",
        type: "bar",
        marker: { color: "rgba(124,58,237,0.8)" }
      },
      {
        x: countries.map(r => r.Country),
        y: countries.map(r => r.Arrivals),
        name: "Arrivals",
        type: "bar",
        marker: { color: "rgba(34,211,238,0.8)" }
      }
    ], {
      barmode: "group",
      margin: { t: 30, r: 20, l: 40, b: 80 },
      legend: { orientation: "h", y: -0.3 },
    }, { responsive: true });

    // Cities Chart
    Plotly.newPlot("cities-chart", [
      {
        x: cities.map(r => r.City),
        y: cities.map(r => r.Departures),
        name: "Departures",
        type: "bar",
        marker: { color: "rgba(124,58,237,0.8)" }
      },
      {
        x: cities.map(r => r.City),
        y: cities.map(r => r.Arrivals),
        name: "Arrivals",
        type: "bar",
        marker: { color: "rgba(34,211,238,0.8)" }
      }
    ], {
      barmode: "group",
      margin: { t: 30, r: 20, l: 40, b: 80 },
      legend: { orientation: "h", y: -0.3 },
    }, { responsive: true });
  }

  // Initial render
  renderCharts(initialCountries, initialCities);

  // Airline filter
  document.getElementById("airline-filter").addEventListener("change", function () {
    const selected = this.value;
    const data = selected === "All" ? airlinesData["All"] : airlinesData[selected];
    renderCharts(data.countries, data.cities);

    // Update tables
    document.querySelector("#countries-table tbody").innerHTML =
      data.countries.map(r => `<tr><td>${r.Country}</td><td>${r.Departures}</td><td>${r.Arrivals}</td></tr>`).join("");

    document.querySelector("#cities-table tbody").innerHTML =
      data.cities.map(r => `<tr><td>${r.City}</td><td>${r.Departures}</td><td>${r.Arrivals}</td></tr>`).join("");
  });
});
</script>
<style>
  /* ğŸ¨ Dark Mode fixes for this page */

  body.dark-mode .section-title {
    color: #e5e5e5 !important;
  }

  body.dark-mode .card,
  body.dark-mode .card-header,
  body.dark-mode .card-body {
    background-color: #111 !important;
    color: #ddd !important;
  }

  body.dark-mode .card-header {
    border-bottom: 1px solid rgba(255, 255, 255, 0.15) !important;
  }

  body.dark-mode .table {
    color: #ddd !important;
  }

  body.dark-mode .table thead {
    background-color: rgba(18,18,18,0.9) !important;
  }

  body.dark-mode .breadcrumb {
    background-color: transparent !important;
  }

  body.dark-mode .breadcrumb-item {
    color: #ccc !important;
  }

  body.dark-mode .breadcrumb-item a {
    color: #93c5fd !important;
    text-decoration: none;
  }

  body.dark-mode .breadcrumb-item a:hover {
    color: #fff !important;
    text-decoration: underline;
  }

  body.dark-mode .breadcrumb-item.active {
    color: #999 !important;
  }

  body.dark-mode .text-muted {
    color: #aaa !important;
  }
  body.dark-mode .card.shadow-sm {
  border: 1px solid #fff !important;
}
.last-update-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.92rem;
  font-weight: 500;
  padding: 0.4rem 1rem;
  border-radius: 999px;
  background-color: rgba(165, 141, 252, 0.08); /* soft lavender */
  border: 1px solid #c084fc; /* light purple border */
  color: #4b5563; /* neutral-600 */
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  white-space: nowrap;
}

.last-update-badge i {
  font-size: 1rem;
  color: #9ca3af; /* gray-400 */
}

.last-update-badge strong {
  font-weight: 700;
  color: #111827; /* gray-900 */
}
body.dark-mode .last-update-badge {
  background-color: rgba(165, 141, 252, 0.12);
  border-color: #a78bfa;
  color: #d1d5db;
}

body.dark-mode .last-update-badge strong {
  color: #fff;
}

body.dark-mode .last-update-badge i {
  color: #c4b5fd;
}
/* âœ… Bootstrap's table-primary header fix */
body.dark-mode .table-primary > * > tr > th {
  background-color: #2e2e2e !important;
  color: #ffffff !important;
}

/* âœ… Fix striped rows (table-striped) */
body.dark-mode .table-striped > tbody > tr:nth-of-type(odd) {
  background-color: rgba(255, 255, 255, 0.05) !important;
}

/* âœ… Ensure table cells also go light */
body.dark-mode table th,
body.dark-mode table td {
  color: #e0e0e0 !important;
  background-color: transparent !important;
}

/* âœ… Optional: fix select box (airline filter) */
body.dark-mode select.form-select {
  background-color: #222 !important;
  color: #fff !important;
  border-color: #444 !important;
}

</style>
{% endblock %}

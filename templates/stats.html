{% extends "base.html" %}

{% block title %}Ben Gurion Airport â€” Current Flight Statistics{% endblock %}

{% block head %}
<!-- Canonical & hreflang for /stats -->
<link rel="canonical" href="https://fly-tlv.com/stats" />
<link rel="alternate" hreflang="en" href="https://fly-tlv.com/stats" />
<link rel="alternate" hreflang="he" href="https://fly-tlv.com/stats?lang=he" />
<link rel="stylesheet" href="{{ url_for('static', path='css/app.css') }}?v={{ time.time() }}">

<!-- âœ… Page-specific SEO -->
<meta name="description"
  content="Live flight statistics from Ben Gurion Airport (TLV). Explore the top destinations, airlines, countries, and cities with departures and arrivals updated in real-time.">
<meta name="keywords"
  content="Ben Gurion Airport, TLV flights, flight statistics, top destinations, airlines, arrivals, departures, Tel Aviv flights">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
<meta property="og:description"
  content="See live statistics from Ben Gurion Airport (TLV). Explore top countries, cities, and airlines for departures and arrivals.">
<meta property="og:url" content="https://fly-tlv.com/stats">
<meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
<meta property="og:image:alt" content="Ben Gurion Airport TLV statistics dashboard">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
<meta name="twitter:description"
  content="Live departures and arrivals statistics from TLV airport. Updated charts with top destinations and airlines.">
<meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
<meta name="twitter:image:alt" content="TLV airport stats overview">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://fly-tlv.com/#organization",
      "name": "Fly TLV",
      "url": "https://fly-tlv.com/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://fly-tlv.com/static/icons/favicon-512.png",
        "width": 512,
        "height": 512
      },
      "sameAs": [
        "https://www.facebook.com/flytlv",
        "https://www.instagram.com/flytlv",
        "https://www.linkedin.com/company/flytlv"
      ]
    },
    {
      "@type": "WebSite",
      "@id": "https://fly-tlv.com/#website",
      "url": "https://fly-tlv.com/",
      "name": "Fly TLV â€” Direct Destinations from Tel Aviv",
      "publisher": { "@id": "https://fly-tlv.com/#organization" },
      "inLanguage": "en-US",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://fly-tlv.com/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@type": "WebPage",
      "@id": "https://fly-tlv.com/stats#webpage",
      "url": "https://fly-tlv.com/stats",
      "name": "Airport Statistics â€” Fly TLV",
      "description": "View flight statistics, destination trends, airline frequencies, and traffic data for Tel Aviv Ben Gurion Airport (TLV).",
      "inLanguage": "en-US",
      "isPartOf": { "@id": "https://fly-tlv.com/#website" },
      "alternateLanguage": "https://fly-tlv.com/stats?lang=he",
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://fly-tlv.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Statistics",
            "item": "https://fly-tlv.com/stats"
          }
        ]
      }
    },
    {
      "@type": "ItemList",
      "@id": "https://fly-tlv.com/#navigation",
      "name": "Site Navigation",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "item": { "@type": "SiteNavigationElement", "name": "Home", "url": "https://fly-tlv.com/" } },
        { "@type": "ListItem", "position": 2, "item": { "@type": "SiteNavigationElement", "name": "×‘×™×ª", "url": "https://fly-tlv.com/?lang=he" } },
        { "@type": "ListItem", "position": 3, "item": { "@type": "SiteNavigationElement", "name": "About", "url": "https://fly-tlv.com/about" } },
        { "@type": "ListItem", "position": 4, "item": { "@type": "SiteNavigationElement", "name": "×¢×œ×™× ×•", "url": "https://fly-tlv.com/about?lang=he" } }
      ]
    }
  ]
}
</script>
{% endblock %}

{% block content %}

<!-- Hero Section -->
<div class="hero-section text-center py-5 shadow-sm mb-4" lang="{{ lang }}"
  dir="{{ 'rtl' if lang == 'he' else 'ltr' }}">
  <div class="container position-relative z-1">
    <h1 class="fw-bold mb-2">
      {% if lang == 'he' %}
      ğŸ“Š × ×ª×•× ×™ ×˜×™×¡×•×ª ×¢×“×›× ×™×™× â€“ × ××œ ×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ
      {% else %}
      ğŸ“Š Ben Gurion Airport â€” Current Flight Statistics
      {% endif %}
    </h1>
    <div class="last-update-badge mt-2 d-inline-flex align-items-center">
      <i class="bi bi-clock-history"></i>
      <span class="label-text">
        {% if lang == 'he' %}×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:{% else %}Last update:{% endif %}
      </span>
      <strong>{{ last_update | default('â€”') }}</strong>
    </div>
  </div>
</div>

<div class="container my-4" lang="{{ lang }}" dir="{{ 'rtl' if lang == 'he' else 'ltr' }}">
  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item">
        <a href="/{{ '' if lang != 'he' else '?lang=he' }}">
          {{ 'Home' if lang != 'he' else '×‘×™×ª' }}
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ 'Statistics' if lang != 'he' else '×¡×˜×˜×™×¡×˜×™×§×•×ª' }}
      </li>
    </ol>
  </nav>

  <!-- Kiwi / Travelpayouts Banner -->
  <div class="card mb-4 shadow-sm" aria-label="Advertisement">
    <div class="card-header small text-muted fw-semibold">
      <i class="bi bi-airplane-engines me-1 text-primary"></i>
      {% if lang == 'he' %} ×˜×™×¡×•×ª ×–×•×œ×•×ª {% else %} Cheap Flights {% endif %}
    </div>
    <div class="card-body text-center">
      <script async
        src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.kiwi_banner&locale=en&stops=any&show_hotels=true&powered_by=true&border_radius=30&plain=true&color_button=%232563eb&color_button_text=%23ffffff&promo_id=3414&campaign_id=111"
        charset="utf-8"></script>
    </div>
  </div>


  <!-- Airline Filter -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-12 col-md-auto">
          <label for="airline-filter" class="form-label fw-semibold mb-0">âœˆï¸ {% if lang == 'he' %}×¡×™× ×•×Ÿ ×œ×¤×™ ×—×‘×¨×ª ×ª×¢×•×¤×”{%
            else %}Filter by Airline{% endif %}</label>
        </div>
        <div class="col-12 col-md">
          <select id="airline-filter" class="form-select">
            <option value="All">
              {% if lang == 'he' %}×›×œ ×”×—×‘×¨×•×ª{% else %}All Airlines{% endif %}
            </option>
            {% for airline in airlines %}<option value="{{ airline }}">{{ airline }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Top Countries -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header fw-bold text-primary">
          ğŸŒ {% if lang == 'he' %}×”××“×™× ×•×ª ×”××•×‘×™×œ×•×ª{% else %}Top Countries{% endif %}
        </div>
        <div class="card-body">
          <div class="table-responsive mb-3">
            <table id="countries-table"
              class="styled-table table table-striped table-hover table-sm align-middle text-center">
              <thead class="table-primary">
                <tr>
                  <th>{% if lang == 'he' %}××“×™× ×”{% else %}Country{% endif %}</th>
                  <th>{% if lang == 'he' %}×”××¨××•×ª{% else %}Departures{% endif %}</th>
                  <th>{% if lang == 'he' %}× ×—×™×ª×•×ª{% else %}Arrivals{% endif %}</th>
                </tr>
              </thead>
              <tbody>
                {% for row in top_countries %}
                <tr>
                  <td>{{ row.Country }}</td>
                  <td>{{ row.Departures }}</td>
                  <td>{{ row.Arrivals }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="countries-chart" style="height:320px;"></div>
        </div>
      </div>
    </div>

    <!-- Top Cities -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header fw-bold text-primary">
          ğŸ™ï¸ {% if lang == 'he' %}×”×¢×¨×™× ×”××•×‘×™×œ×•×ª{% else %}Top Cities{% endif %}
        </div>
        <div class="card-body">
          <div class="table-responsive mb-3">
            <table id="cities-table"
              class="styled-table table table-striped table-hover table-sm align-middle text-center">
              <thead class="table-primary">
                <tr>
                  <th>{% if lang == 'he' %}×¢×™×¨{% else %}City{% endif %}</th>
                  <th>{% if lang == 'he' %}×”××¨××•×ª{% else %}Departures{% endif %}</th>
                  <th>{% if lang == 'he' %}× ×—×™×ª×•×ª{% else %}Arrivals{% endif %}</th>
                </tr>
              </thead>
              <tbody>
                {% for row in top_cities %}
                <tr>
                  <td>{{ row.City }}</td>
                  <td>{{ row.Departures }}</td>
                  <td>{{ row.Arrivals }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div id="cities-chart" style="height:320px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ads Under Table -->
  <div class="row mt-4">
    <div class="col-12 col-md-6">
      <div class="card shadow-sm h-100" aria-label="Advertisement">
        <div class="card-header small text-muted fw-semibold">
          <i class="bi bi-airplane-engines me-1 text-primary"></i>
          {% if lang == 'he' %} ××‘×¦×¢×™× ×¢×œ ×˜×™×¡×•×ª {% else %} Flight Deals {% endif %}
        </div>
        <div class="card-body text-center p-0 overflow-hidden">
          <script async
            src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.kiwi_under_tb1&locale=en&powered_by=true&limit=4&primary_color=0049AEff&results_background_color=FFFFFF&form_background_color=FFFFFF&promo_id=4563&campaign_id=111"
            charset="utf-8"></script>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6 mt-3 mt-md-0">
      <div class="card shadow-sm h-100" aria-label="Advertisement">
        <div class="card-header small text-muted fw-semibold">
          <i class="bi bi-airplane me-1 text-primary"></i>
          {% if lang == 'he' %} ×¡×™× ×–×•×œ {% else %} Cheap ESIM {% endif %}
        </div>
        <div class="card-body text-center p-0 overflow-hidden">
          <script async
            src="https://tpembd.com/content?trs=461563&shmarker=674907.kiwi_under_tb2&locale=en&powered_by=true&color_button=%230049AE&color_focused=%230049AE&secondary=%23FFFFFF&dark=%2311100f&light=%23FFFFFF&special=%23C4C4C4&border_radius=30&plain=false&no_labels=true&promo_id=8588&campaign_id=541"
            charset="utf-8"></script>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const airlinesData = {{ airlines_data | tojson
  }};
  const initialCountries = {{ top_countries | tojson }};
  const initialCities = {{ top_cities | tojson }};

  function renderCharts(countries, cities) {
    // Countries Chart
    Plotly.newPlot("countries-chart", [
      {
        x: countries.map(r => r.Country),
        y: countries.map(r => r.Departures),
        name: "Departures",
        type: "bar",
        marker: { color: "rgba(124,58,237,0.8)" }
      },
      {
        x: countries.map(r => r.Country),
        y: countries.map(r => r.Arrivals),
        name: "Arrivals",
        type: "bar",
        marker: { color: "rgba(34,211,238,0.8)" }
      }
    ], {
      barmode: "group",
      margin: { t: 30, r: 20, l: 40, b: 80 },
      legend: { orientation: "h", y: -0.3 },
      paper_bgcolor: 'rgba(0,0,0,0)',
      plot_bgcolor: 'rgba(0,0,0,0)',
      font: { color: document.body.classList.contains('dark-mode') ? '#e5e5e5' : '#333' }
    }, { responsive: true });

    // Cities Chart
    Plotly.newPlot("cities-chart", [
      {
        x: cities.map(r => r.City),
        y: cities.map(r => r.Departures),
        name: "Departures",
        type: "bar",
        marker: { color: "rgba(124,58,237,0.8)" }
      },
      {
        x: cities.map(r => r.City),
        y: cities.map(r => r.Arrivals),
        name: "Arrivals",
        type: "bar",
        marker: { color: "rgba(34,211,238,0.8)" }
      }
    ], {
      barmode: "group",
      margin: { t: 30, r: 20, l: 40, b: 80 },
      legend: { orientation: "h", y: -0.3 },
      paper_bgcolor: 'rgba(0,0,0,0)',
      plot_bgcolor: 'rgba(0,0,0,0)',
      font: { color: document.body.classList.contains('dark-mode') ? '#e5e5e5' : '#333' }
    }, { responsive: true });
  }

  // Initial render
  renderCharts(initialCountries, initialCities);

  // Airline filter
  document.getElementById("airline-filter").addEventListener("change", function () {
    const selected = this.value;
    const data = selected === "All" ? airlinesData["All"] : airlinesData[selected];
    renderCharts(data.countries, data.cities);

    // Update tables
    document.querySelector("#countries-table tbody").innerHTML =
      data.countries.map(r => `<tr><td>${r.Country}</td><td>${r.Departures}</td><td>${r.Arrivals}</td></tr>`).join("");

    document.querySelector("#cities-table tbody").innerHTML =
      data.cities.map(r => `<tr><td>${r.City}</td><td>${r.Departures}</td><td>${r.Arrivals}</td></tr>`).join("");
  });
});
</script>
{% endblock %}
{% extends "base.html" %}
{% block title -%}
  {{ 'Travel Questionnaire â€” TLV â†’ Worldwide Destinations | Find Airlines and Travel Warnings'
     if lang != 'he' else
     '×©××œ×•×Ÿ × ×¡×™×¢×•×ª â€” TLV â†’ ×›×œ ×”×™×¢×“×™× ××©×“×” ×”×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ ×ª×œ ××‘×™×‘' }}
{%- endblock %}

{% block head_extra %}
  <!-- Canonical & hreflang -->
  <link rel="canonical" href="https://fly-tlv.com/travel-questionnaire{{ '' if lang != 'he' else '?lang=he' }}" />
  <link rel="alternate" href="https://fly-tlv.com/travel-questionnaire" hreflang="en-US" />
  <link rel="alternate" href="https://fly-tlv.com/travel-questionnaire?lang=he" hreflang="he-IL" />
  <link rel="alternate" href="https://fly-tlv.com/travel-questionnaire" hreflang="x-default" />

  <!-- SEO essentials -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="application-name" content="Fly TLV" />
  <meta name="author" content="Fly TLV Team" />
  <meta name="theme-color" content="#004aad" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />

  <!-- Description -->
  <meta name="description" content="{{
    'Interactive travel questionnaire to explore where you can fly directly from Tel Aviv (TLV). Choose a country, city, or airport and instantly see active airlines and official travel warnings updated from government APIs.'
    if lang != 'he' else
    '×©××œ×•×Ÿ × ×¡×™×¢×•×ª ××™× ×˜×¨××§×˜×™×‘×™ ×œ×’×™×œ×•×™ ×™×¢×“×™ ×˜×™×¡×” ×™×©×™×¨×™× ×× ×ª×‘×´×’ ×ª×œ ××‘×™×‘ (TLV). ×‘×—×¨×• ××“×™× ×”, ×¢×™×¨ ××• ×©×“×” ×ª×¢×•×¤×” ×•×ª×•×›×œ×• ×œ×¨××•×ª ××™×™×“×™×ª ××™×œ×• ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×¢×™×œ×•×ª ×•××™×œ×• ××–×”×¨×•×ª ××¡×¢ ×¨×©××™×•×ª ×‘×ª×•×§×£, ×‘×¢×“×›×•×Ÿ ×××¢×¨×›×•×ª ×”××“×™× ×”.'
  }}" />

  <meta name="keywords" content="TLV travel questionnaire, Ben Gurion destinations, direct flights Tel Aviv, airlines TLV, travel warnings Israel, nonstop routes TLV" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Fly TLV â€” Worldwide Destinations" />
  <meta property="og:url" content="https://fly-tlv.com/travel-questionnaire{{ '' if lang != 'he' else '?lang=he' }}" />
  <meta property="og:locale" content="{{ 'en_US' if lang != 'he' else 'he_IL' }}" />
  <meta property="og:title" content="{{
    'Travel Questionnaire â€” TLV â†’ Worldwide Destinations'
    if lang != 'he' else
    '×©××œ×•×Ÿ × ×¡×™×¢×•×ª â€” TLV â†’ ×›×œ ×”×™×¢×“×™× ××©×“×” ×”×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ ×ª×œ ××‘×™×‘'
  }}" />
  <meta property="og:description" content="{{
    'Discover direct destinations, airlines, and official travel warnings from Tel Aviv Ben Gurion Airport (TLV). Data sourced from verified APIs and government databases.'
    if lang != 'he' else
    '×’×œ×• ×™×¢×“×™× ×™×©×™×¨×™×, ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×•××–×”×¨×•×ª ××¡×¢ ×¨×©××™×•×ª ×× ×ª×‘×´×’ ×ª×œ ××‘×™×‘ (TLV). ×”× ×ª×•× ×™× ××‘×•×¡×¡×™× ×¢×œ ××§×•×¨×•×ª ×¨×©××™×™× ×•Ö¾API ×××©×œ×ª×™×™×.'
  }}" />
  <meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_world.jpg" />
  <meta property="og:image:alt" content="{{ 'Interactive TLV travel questionnaire' if lang != 'he' else '×©××œ×•×Ÿ × ×¡×™×¢×•×ª ×× ×ª×‘×´×’ ×ª×œ ××‘×™×‘' }}" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@flyTLV" />
  <meta name="twitter:title" content="{{
    'Travel Questionnaire â€” TLV â†’ Worldwide Destinations'
    if lang != 'he' else
    '×©××œ×•×Ÿ × ×¡×™×¢×•×ª â€” TLV â†’ ×›×œ ×”×™×¢×“×™× ××©×“×” ×”×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ ×ª×œ ××‘×™×‘'
  }}" />
  <meta name="twitter:description" content="{{
    'Choose a country, city, or airport and explore airlines and travel warnings for direct destinations from Tel Aviv Ben Gurion Airport.'
    if lang != 'he' else
    '×‘×—×¨×• ××“×™× ×”, ×¢×™×¨ ××• ×©×“×” ×ª×¢×•×¤×” ×•×’×œ×• ××™×œ×• ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×•×¢×œ×•×ª ×× ×ª×‘×´×’ ×•××”×Ÿ ××–×”×¨×•×ª ×”××¡×¢ ×”×¤×¢×™×œ×•×ª.'
  }}" />
  <meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_world.jpg" />

<!-- Structured Data: Travel Questionnaire -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [

    {
      "@type": "Organization",
      "@id": "https://fly-tlv.com/#organization",
      "name": "Fly TLV",
      "url": "https://fly-tlv.com/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://fly-tlv.com/static/icons/favicon-512.png",
        "width": 512,
        "height": 512
      },
      "sameAs": [
        "https://www.facebook.com/flytlv",
        "https://www.instagram.com/flytlv",
        "https://www.linkedin.com/company/flytlv"
      ]
    },

    {
      "@type": "WebSite",
      "name": "Fly TLV â€” Worldwide Destinations",
      "url": "https://fly-tlv.com/",
      "inLanguage": "en-US",
      "publisher": { "@id": "https://fly-tlv.com/#organization" }
    },

    {
      "@type": "WebPage",
      "@id": "https://fly-tlv.com/travel-questionnaire/#webpage",
      "url": "https://fly-tlv.com/travel-questionnaire{{ '' if lang != 'he' else '?lang=he' }}",
      "name": "{{ 'Travel Questionnaire â€” Fly TLV' if lang != 'he' else '×©××œ×•×Ÿ × ×¡×™×¢×•×ª â€” Fly TLV' }}",
      "inLanguage": "{{ 'he-IL' if lang == 'he' else 'en-US' }}",
      "description": "{{ 'Interactive tool to explore direct flights, airlines, and travel advisories from Tel Aviv (TLV).' if lang != 'he' else '×›×œ×™ ××™× ×˜×¨××§×˜×™×‘×™ ×œ×’×™×œ×•×™ ×™×¢×“×™ ×˜×™×¡×” ×™×©×™×¨×™×, ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×•××–×”×¨×•×ª ××¡×¢ ×× ×ª×‘×´×’ ×ª×œ ××‘×™×‘.' }}",
      "publisher": { "@id": "https://fly-tlv.com/#organization" },
      "isPartOf": { "@id": "https://fly-tlv.com/#organization" },
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": "https://fly-tlv.com/static/og/flytlv_world.jpg",
        "width": 1200,
        "height": 630
      }
    },

    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "{{ 'Home' if lang != 'he' else '×‘×™×ª' }}", "item": "https://fly-tlv.com/{{ '?lang=he' if lang == 'he' else '' }}" },
        { "@type": "ListItem", "position": 2, "name": "{{ 'Travel Questionnaire' if lang != 'he' else '×©××œ×•×Ÿ × ×¡×™×¢×•×ª' }}", "item": "https://fly-tlv.com/travel-questionnaire{{ '?lang=he' if lang == 'he' else '' }}" }
      ]
    },

    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is the Travel Questionnaire?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The Fly TLV Travel Questionnaire helps travelers explore which destinations, cities, and airports can be reached by direct flights from Tel Aviv (TLV)."
          }
        },
        {
          "@type": "Question",
          "name": "Where does the travel warning information come from?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Travel warnings are updated directly from verified government sources and public APIs, including Israelâ€™s official National Security Council data."
          }
        },
        {
          "@type": "Question",
          "name": "Can I book flights directly through Fly TLV?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Fly TLV provides verified airline links and travel tools but does not sell tickets directly."
          }
        }
      ],
      "publisher": { "@id": "https://fly-tlv.com/#organization" }
    }
  ]
}
</script>

{% endblock %}


{% block content %}
<div class="container mt-5" {% if lang == 'he' %}dir="rtl"{% endif %}>
  <div class="card shadow">
    <div class="card-header bg-primary text-white text-center fw-semibold">
      âœˆï¸ {{ 'Travel Questionnaire' if lang != 'he' else '×©××œ×•×Ÿ × ×¡×™×¢×•×ª' }}
    </div>
<div class="col-12 text-center">
  <span class="last-update-badge d-inline-block mt-1 mx-auto">
    <i class="bi bi-clock-history"></i>
    {% if lang == "he" %}
      ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: <strong>{{ last_update }}</strong>
    {% else %}
      Last update: <strong>{{ last_update }}</strong>
    {% endif %}
  </span>
</div>
    <div class="card-body">
      <form id="travel-form">
        <!-- Country -->
        <div class="mb-3">
          <label for="country" class="form-label">
            ğŸŒ {{ 'Where do you want to fly?' if lang != 'he' else '×œ××Ÿ ×ª×¨×¦×• ×œ×˜×•×¡?' }}
          </label>
          <select class="form-select" id="country" required>
            <option value="">
              {{ 'Choose a country' if lang != 'he' else '×‘×—×¨×• ××“×™× ×”' }}
            </option>
            {% for country in countries %}
              <option value="{{ country }}">{{ country }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Travel warning -->
        <div id="warning-container"
             class="mt-4 d-none {% if lang == 'he' %}text-end{% else %}text-start{% endif %}"
             {% if lang == 'he' %}dir="rtl"{% endif %}>
          <h5>
            âš ï¸ {{ 'Travel Warning' if lang != 'he' else '××–×”×¨×ª ××¡×¢' }}
          </h5>
          <div class="alert alert-warning" id="warning-message"></div>
        </div>

        <!-- City -->
        <div class="mb-3 d-none" id="city-container">
          <label for="city" class="form-label">
            ğŸ™ï¸ {{ 'Which city?' if lang != 'he' else '××™×–×• ×¢×™×¨?' }}
          </label>
          <select class="form-select" id="city" required></select>
        </div>

        <!-- Airport -->
        <div class="mb-3 d-none" id="airport-container">
          <label for="airport" class="form-label">
            ğŸ›« {{ 'Which airport?' if lang != 'he' else '××™×–×” ×©×“×” ×ª×¢×•×¤×”?' }}
          </label>
          <select class="form-select" id="airport" required></select>
        </div>
      </form>

      <!-- Airlines -->
      <div id="airlines-container" class="mt-4 d-none">
        <h6>
          âœˆï¸ {{ 'Airlines' if lang != 'he' else '×—×‘×¨×•×ª ×ª×¢×•×¤×”' }}
        </h6>
        <div id="airlines-chips" class="d-flex flex-wrap gap-2"></div>
      </div>
	  <div id="ad-container" class="card mt-3 shadow-sm d-none" aria-label="Flightstoshow">
		  <div id="ad-header" class="card-header small text-muted fw-semibold">
			<i class="bi bi-airplane-engines me-1 text-primary"></i>
			{{ 'Direct Flight Deals' if lang != 'he' else '××‘×¦×¢×™ ×˜×™×¡×•×ª ×™×©×™×¨×•×ª' }}
		  </div>
		  <div class="card-body text-center p-0" id="ad-body"></div>
		</div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const lang = "{{ lang or 'en' }}";
  const countrySelect = document.getElementById("country");
  const citySelect = document.getElementById("city");
  const airportSelect = document.getElementById("airport");
  const cityContainer = document.getElementById("city-container");
  const airportContainer = document.getElementById("airport-container");
  const warningContainer = document.getElementById("warning-container");
  const warningMessage = document.getElementById("warning-message");
  const airlinesContainer = document.getElementById("airlines-container");
  const airlinesChips = document.getElementById("airlines-chips");

  const adContainer = document.getElementById("ad-container");
  const adBody = document.getElementById("ad-body");
  const adHeader = document.getElementById("ad-header");

  let currentAirportData = [];

  const t = {
    choose_city: lang === "he" ? "×‘×—×¨×• ×¢×™×¨" : "Choose a city",
    choose_airport: lang === "he" ? "×‘×—×¨×• ×©×“×” ×ª×¢×•×¤×”" : "Choose an airport",
    travel_warning: lang === "he" ? "××–×”×¨×ª ××¡×¢" : "Travel Warning",
    no_airlines: lang === "he" ? "××™×Ÿ ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×¢×™×œ×•×ª" : "No airlines available",
  };

  // Show travel warnings for selected country
  async function showTravelWarnings(country) {
    const warnRes = await fetch(`/api/warnings?country=${encodeURIComponent(country)}`);
    const warnData = await warnRes.json();

    if (warnData.warnings && warnData.warnings.length > 0) {
      const messages = warnData.warnings.map(w => {
        const safeText = w.recommendations || "âš ï¸ Travel advisory issued.";
        const safeLink = w.link
          ? `<a href="${w.link}" target="_blank" rel="noopener noreferrer" class="ms-1 text-decoration-underline">[More info]</a>`
          : "";

        let formattedDate = "";
        if (w.date) {
          const dateObj = new Date(w.date);
          if (!isNaN(dateObj)) {
            formattedDate = dateObj.toLocaleDateString(lang === "he" ? "he-IL" : "en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            });
            formattedDate = `<div class="text-muted small mt-1">${formattedDate}</div>`;
          }
        }

        return `<p class="mb-2">${safeText}${safeLink}${formattedDate}</p>`;
      }).join("");

      warningMessage.innerHTML = messages;
      warningContainer.classList.remove("d-none");
    } else {
      warningMessage.innerHTML = "";
      warningContainer.classList.add("d-none");
    }
  }

  // Country selection â†’ cities + travel warnings
  countrySelect.addEventListener("change", async () => {
    const country = countrySelect.value;
    resetBelow("country");

    if (country) {
      const res = await fetch(`/api/cities?country=${encodeURIComponent(country)}`);
      const data = await res.json();
      citySelect.innerHTML = `<option value="">${t.choose_city}</option>`;
      data.cities.forEach(city => {
        citySelect.innerHTML += `<option value="${city}">${city}</option>`;
      });
      cityContainer.classList.remove("d-none");

      // Auto-select city if there's only one
      if (data.cities.length === 1) {
        citySelect.value = data.cities[0];
        citySelect.dispatchEvent(new Event("change"));
      }

      // Show travel warnings immediately on country change
      await showTravelWarnings(country);
    }
  });

  // City selection â†’ airports
  citySelect.addEventListener("change", async () => {
    const country = countrySelect.value;
    const city = citySelect.value;
    resetBelow("city");

    if (city) {
      const res = await fetch(`/api/airports?country=${encodeURIComponent(country)}&city=${encodeURIComponent(city)}`);
      const data = await res.json();
      currentAirportData = data.airports;

      airportSelect.innerHTML = `<option value="">${t.choose_airport}</option>`;
      data.airports.forEach(airport => {
        airportSelect.innerHTML += `<option value="${airport.iata}">${airport.name} (${airport.iata})</option>`;
      });
      airportContainer.classList.remove("d-none");

      if (data.airports.length === 1) {
        airportSelect.value = data.airports[0].iata;
        airportSelect.dispatchEvent(new Event("change"));
      }
    }
  });

  // Airport selection â†’ airlines + ad
  airportSelect.addEventListener("change", () => {
    const selectedIATA = airportSelect.value;
    const selected = currentAirportData.find(a => a.iata === selectedIATA);
    const cityName = citySelect.value;

    airlinesChips.innerHTML = "";

    if (selected && selected.airlines && selected.airlines.length > 0) {
      selected.airlines.forEach(airline => {
        const chip = document.createElement("span");
        chip.className = "airline-chip text-decoration-none";
        chip.innerText = airline;
        airlinesChips.appendChild(chip);
      });
      airlinesContainer.classList.remove("d-none");
    } else {
      airlinesContainer.classList.add("d-none");
      airlinesChips.innerHTML = `<span class="text-muted small">${t.no_airlines}</span>`;
    }

    // Ad widget logic
    if (!selectedIATA) {
      adContainer.classList.add("d-none");
      adBody.innerHTML = "";
      return;
    }

    adHeader.innerHTML =
      lang === "he"
        ? `<i class="bi bi-airplane-engines me-1 text-primary"></i> ××‘×¦×¢×™ ×˜×™×¡×•×ª ××ª×œ ××‘×™×‘ ××œ ${cityName}`
        : `<i class="bi bi-airplane-engines me-1 text-primary"></i> Direct Flight Deals from TLV to ${cityName}`;

    const theme = localStorage.getItem("fe-theme") || "light";
    const localeParam = lang === 'he' ? 'he' : 'en';

    const scriptUrl = `https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.questionnar&searchUrl=www.aviasales.com%2Fsearch&locale=${localeParam}&powered_by=true&origin=TLV&destination=${selected.iata}&one_way=false&only_direct=true&period=year&range=7%2C14&primary=%230C73FE&color_background=%23ffffff&dark=%23000000&light=%23FFFFFF&achieve=%230F57C9ff&promo_id=4041&campaign_id=100`;

    adBody.innerHTML = "";
    const script = document.createElement("script");
    script.src = scriptUrl;
    script.async = true;
    script.charset = "utf-8";
    adBody.appendChild(script);

    adContainer.classList.remove("d-none");
  });

  // Reset UI
  function resetBelow(level) {
    if (level === "country") {
      cityContainer.classList.add("d-none");
      citySelect.innerHTML = "";
      resetBelow("city");
    }
    if (level === "city") {
      airportContainer.classList.add("d-none");
      airportSelect.innerHTML = "";
      warningContainer.classList.add("d-none");
      warningMessage.innerHTML = "";
      airlinesContainer.classList.add("d-none");
      airlinesChips.innerHTML = "";
      adContainer.classList.add("d-none");
      adBody.innerHTML = "";
    }
  }
});
</script>


<style>
#ad-container {
  opacity: 0;
  transition: opacity 0.4s ease;
}
#ad-container:not(.d-none) {
  opacity: 1;
}
/* ğŸŒ™ Dark-mode fixes for Travel Questionnaire */
body.dark-mode select.form-select,
body.dark-mode input.form-control,
body.dark-mode textarea.form-control {
  background-color: #1e1e1e !important;
  color: #f1f1f1 !important;
  border-color: #444 !important;
}

body.dark-mode select.form-select:focus,
body.dark-mode input.form-control:focus,
body.dark-mode textarea.form-control:focus {
  background-color: #252525 !important;
  color: #fff !important;
  border-color: #3a8bff !important;
  box-shadow: 0 0 0 0.15rem rgba(50, 168, 221, 0.3);
}

/* Dropdown options inside select */
body.dark-mode option {
  background-color: #1e1e1e;
  color: #f1f1f1;
}

/* Travel warning alert */
body.dark-mode .alert-warning {
  background-color: #2e2a00 !important;
  color: #ffe082 !important;
  border-color: #554d00 !important;
}

/* Cards and headers */
body.dark-mode .card {
  background-color: #181818 !important;
  border-color: #2a2a2a !important;
}

body.dark-mode .card-header {
  background-color: #0d6efd !important;
  color: #fff !important;
}

/* Labels and text */
body.dark-mode label.form-label,
body.dark-mode h5,
body.dark-mode h6 {
  color: #e0e0e0 !important;
}
</style>



{% endblock %}

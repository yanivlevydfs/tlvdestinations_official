{% extends "base.html" %}
{% block title -%}
{{ 'Travel Guide â€” TLV â†’ Worldwide Destinations | Find Airlines and Travel Warnings'
if lang != 'he' else
'××“×¨×™×š × ×¡×™×¢×•×ª â€” TLV â†’ ×›×œ ×”×™×¢×“×™× ××©×“×” ×”×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ ×ª×œ ××‘×™×‘' }}
{%- endblock %}

{% block head %}

<!-- SEO essentials -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
<meta name="application-name" content="Fly TLV" />
<meta name="author" content="Fly TLV Team" />
<meta name="theme-color" content="#004aad" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />

<!-- Description -->
<meta name="description" content="{{
    'Interactive travel questionnaire to explore where you can fly directly from Tel Aviv (TLV). Choose a country, city, or airport and instantly see active airlines and official travel warnings updated from government APIs.'
    if lang != 'he' else
    '×©××œ×•×Ÿ × ×¡×™×¢×•×ª ××™× ×˜×¨××§×˜×™×‘×™ ×œ×’×™×œ×•×™ ×™×¢×“×™ ×˜×™×¡×” ×™×©×™×¨×™× ×× ×ª×‘×´×’ ×ª×œ ××‘×™×‘ (TLV). ×‘×—×¨×• ××“×™× ×”, ×¢×™×¨ ××• ×©×“×” ×ª×¢×•×¤×” ×•×ª×•×›×œ×• ×œ×¨××•×ª ××™×™×“×™×ª ××™×œ×• ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×¢×™×œ×•×ª ×•××™×œ×• ××–×”×¨×•×ª ××¡×¢ ×¨×©××™×•×ª ×‘×ª×•×§×£, ×‘×¢×“×›×•×Ÿ ×××¢×¨×›×•×ª ×”××“×™× ×”.'
  }}" />

<meta name="keywords"
  content="TLV travel questionnaire, Ben Gurion destinations, direct flights Tel Aviv, airlines TLV, travel warnings Israel, nonstop routes TLV" />

<!-- OG / Twitter -->
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Fly TLV â€” Worldwide Destinations" />
<meta property="og:url" content="https://fly-tlv.com/travel-questionnaire{{ '' if lang != 'he' else '?lang=he' }}" />
<meta property="og:locale" content="{{ 'en_US' if lang != 'he' else 'he_IL' }}" />
<meta property="og:title"
  content="{{ 'Travel Guide â€” TLV â†’ Worldwide Destinations' if lang != 'he' else '××“×¨×™×š × ×¡×™×¢×•×ª â€” TLV â†’ ×›×œ ×”×™×¢×“×™× ××©×“×” ×”×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ ×ª×œ ××‘×™×‘' }}" />
<meta property="og:description"
  content="{{ 'Discover direct destinations, airlines, and official travel warnings from Tel Aviv Ben Gurion Airport (TLV).' if lang != 'he' else '×’×œ×• ×™×¢×“×™× ×™×©×™×¨×™×, ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×•××–×”×¨×•×ª ××¡×¢ ×¨×©××™×•×ª ×× ×ª×‘×´×’ ×ª×œ ××‘×™×‘ (TLV). ×”× ×ª×•× ×™× ××‘×•×¡×¡×™× ×¢×œ ××§×•×¨×•×ª ×¨×©××™×™× ×•Ö¾API ×××©×œ×ª×™×™×.' }}" />
<meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_world.jpg" />
<meta property="og:image:alt"
  content="{{ 'Interactive TLV travel guide' if lang != 'he' else '××“×¨×™×š × ×¡×™×¢×•×ª ×× ×ª×‘×´×’ ×ª×œ ××‘×™×‘' }}" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@flyTLV" />
<meta name="twitter:title"
  content="{{ 'Travel Guide â€” TLV â†’ Worldwide Destinations' if lang != 'he' else '××“×¨×™×š × ×¡×™×¢×•×ª â€” TLV â†’ ×›×œ ×”×™×¢×“×™× ××©×“×” ×”×ª×¢×•×¤×” ×‘×Ÿ ×’×•×¨×™×•×Ÿ ×ª×œ ××‘×™×‘' }}" />
<meta name="twitter:description"
  content="{{ 'Choose a country, city, or airport and explore airlines and travel warnings for direct destinations from Tel Aviv.' if lang != 'he' else '×‘×—×¨×• ××“×™× ×”, ×¢×™×¨ ××• ×©×“×” ×ª×¢×•×¤×” ×•×’×œ×• ××™×œ×• ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×•×¢×œ×•×ª ×•××”×Ÿ ××–×”×¨×•×ª ×”××¡×¢.' }}" />
<meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_world.jpg" />
<!-- Structured Data: Travel Questionnaire -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [

    {
      "@type": "WebPage",
      "@id": "https://fly-tlv.com/travel-questionnaire/#page",
      "url": "{{ 'https://fly-tlv.com/travel-questionnaire?lang=he' if lang == 'he' else 'https://fly-tlv.com/travel-questionnaire' }}",
      "name": "{{ 'Travel Questionnaire â€” Fly TLV' if lang != 'he' else '××“×¨×™×š × ×¡×™×¢×•×ª â€” Fly TLV' }}",
      "inLanguage": "{{ 'he-IL' if lang == 'he' else 'en-US' }}",
      "description": "{{ 'Interactive travel questionnaire for exploring direct destinations, airlines, and travel warnings from Tel Aviv (TLV).' 
                        if lang != 'he' 
                        else '×©××œ×•×Ÿ × ×¡×™×¢×•×ª ××™× ×˜×¨××§×˜×™×‘×™ ×œ×’×™×œ×•×™ ×™×¢×“×™× ×™×©×™×¨×™×, ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×•××–×”×¨×•×ª ××¡×¢ ×× ×ª×‘×´×’.' }}",
      "publisher": { "@id": "https://fly-tlv.com/#org" },
      "isPartOf": { "@id": "https://fly-tlv.com/#website" }
    },

    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { 
          "@type": "ListItem", 
          "position": 1, 
          "name": "{{ 'Home' if lang != 'he' else '×‘×™×ª' }}",
          "item": "{{ 'https://fly-tlv.com/?lang=he' if lang == 'he' else 'https://fly-tlv.com/' }}"
        },
        { 
          "@type": "ListItem", 
          "position": 2, 
          "name": "{{ 'Travel Guide' if lang != 'he' else '××“×¨×™×š × ×¡×™×¢×•×ª' }}",
          "item": "{{ 'https://fly-tlv.com/travel-questionnaire?lang=he' if lang == 'he' else 'https://fly-tlv.com/travel-questionnaire' }}"
        }
      ]
    },

    {
      "@type": "FAQPage",
      "@id": "https://fly-tlv.com/travel-questionnaire/#faq",
      "mainEntity": [

        {
          "@type": "Question",
          "name": "{{ 'How does the Travel Questionnaire work?' if lang != 'he' else '××™×š ×¢×•×‘×“ ×©××œ×•×Ÿ ×”× ×¡×™×¢×•×ª?' }}",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "{{ 'Choose a country, then a city and airport, and instantly view airlines and travel warnings updated from official APIs.' 
                      if lang != 'he' 
                      else '×‘×—×¨×• ××“×™× ×”, ×œ××—×¨ ××›×Ÿ ×¢×™×¨ ×•×©×“×” ×ª×¢×•×¤×”, ×•×ª×§×‘×œ×• ××™×™×“×™×ª ××™×œ×• ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×¢×™×œ×•×ª ×•××”×Ÿ ××–×”×¨×•×ª ×”××¡×¢ ×”×¨×©××™×ª.' }}"
          }
        },

        {
          "@type": "Question",
          "name": "{{ 'Where do the travel warnings come from?' if lang != 'he' else '××”×™×›×Ÿ ××’×™×¢×•×ª ××–×”×¨×•×ª ×”××¡×¢?' }}",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "{{ 'Travel warnings are updated directly from official Israeli government National Security Council data.' 
                      if lang != 'he' 
                      else '××–×”×¨×•×ª ×”××¡×¢ ××ª×¢×“×›× ×•×ª ×™×©×™×¨×•×ª ××××’×¨×™ ×”××™×“×¢ ×©×œ ×”××˜×” ×œ×‘×™×˜×—×•×Ÿ ×œ××•××™ (×”××œ×´×œ).' }}"
          }
        },

        {
          "@type": "Question",
          "name": "{{ 'Does Fly TLV sell flight tickets?' if lang != 'he' else '×”×× Fly TLV ××•×›×¨ ×›×¨×˜×™×¡×™ ×˜×™×¡×”?' }}",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "{{ 'Fly TLV does not sell tickets, but provides safe links to airlines, travel tools, and flight comparison partners.' 
                      if lang != 'he' 
                      else 'Fly TLV ××™× ×• ××•×›×¨ ×›×¨×˜×™×¡×™×, ××š ××¡×¤×§ ×§×™×©×•×¨×™× ×‘×˜×•×—×™× ×œ×—×‘×¨×•×ª ×ª×¢×•×¤×”, ×›×œ×™× ×œ× ×¡×™×¢×” ×•××ª×¨×™ ×”×©×•×•××ª ×˜×™×¡×•×ª.' }}"
          }
        },

        {
          "@type": "Question",
          "name": "{{ 'Can I find the cheapest direct flights through the tool?' if lang != 'he' else '×”×× × ×™×ª×Ÿ ×œ××¦×•× ×˜×™×¡×•×ª ×™×©×™×¨×•×ª ×–×•×œ×•×ª ×“×¨×š ×”×©××œ×•×Ÿ?' }}",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "{{ 'Yes. After selecting an airport, the tool shows active airlines and displays direct-flight deals from TLV using real search data.' 
                      if lang != 'he' 
                      else '×›×Ÿ. ×œ××—×¨ ×‘×—×™×¨×ª ×©×“×” ×ª×¢×•×¤×”, ××•×¦×’×•×ª ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×¢×™×œ×•×ª ×•×›×Ÿ ××•×¦×’×™× ××‘×¦×¢×™ ×˜×™×¡×•×ª ×™×©×™×¨×•×ª ××ª×œ ××‘×™×‘ ×‘×”×ª×× ×œ× ×ª×•× ×™ ×—×™×¤×•×© ×××™×ª×™×™×.' }}"
          }
        }

      ],
      "publisher": { "@id": "https://fly-tlv.com/#org" }
    }

  ]
}
</script>


{% endblock %}

{% block content %}
<div class="container mt-5" {% if lang=='he' %}dir="rtl" {% endif %}>
  <div class="card shadow">
    <div class="card-header bg-primary text-white text-center fw-semibold">
      âœˆï¸ {{ 'Travel Guide' if lang != 'he' else '××“×¨×™×š × ×¡×™×¢×•×ª' }}
    </div>

    <div class="col-12 text-center">
      <span class="last-update-badge d-inline-block mt-1 mx-auto">
        <i class="bi bi-clock-history"></i>
        {% if lang == "he" %}
        ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: <strong>{{ last_update }}</strong>
        {% else %}
        Last update: <strong>{{ last_update }}</strong>
        {% endif %}
      </span>
    </div>

    <div class="card-body">

      <!-- FORM -->
      <form id="travel-form">

        <!-- Country -->
        <div class="mb-4 fade-in-up" style="animation-delay: 0.1s;">
          <div class="form-floating">
            <select class="form-select" id="country" required>
              <option value="" selected disabled>{{ 'Select from the list...' if lang != 'he' else '×‘×—×¨×• ××”×¨×©×™××”...' }}
              </option>
              {% for country in countries %}
              <option value="{{ country }}">{{ country }}</option>
              {% endfor %}
            </select>
            <label for="country">
              ğŸŒ {{ 'Where do you want to fly?' if lang != 'he' else '×œ××Ÿ ×ª×¨×¦×• ×œ×˜×•×¡?' }}
            </label>
          </div>
        </div>

        <!-- Travel warning -->
        <div id="warning-container"
          class="mt-4 mb-4 d-none fade-in-up {% if lang == 'he' %}text-end{% else %}text-start{% endif %}" {% if
          lang=='he' %}dir="rtl" {% endif %}>
          <div class="alert alert-warning border-0 shadow-sm" id="warning-message"></div>
        </div>

        <!-- City -->
        <div class="mb-4 d-none" id="city-container">
          <div class="form-floating">
            <select class="form-select" id="city" required></select>
            <label for="city">
              ğŸ™ï¸ {{ 'Which city?' if lang != 'he' else '××™×–×• ×¢×™×¨?' }}
            </label>
          </div>
        </div>

        <!-- Airport -->
        <div class="mb-4 d-none" id="airport-container">
          <div class="form-floating">
            <select class="form-select" id="airport" required></select>
            <label for="airport">
              ğŸ›« {{ 'Which airport?' if lang != 'he' else '××™×–×” ×©×“×” ×ª×¢×•×¤×”?' }}
            </label>
          </div>
        </div>

      </form>

      <!-- Airlines -->
      <div id="airlines-container" class="mt-4 d-none fade-in-up">
        <h6 class="text-muted small text-uppercase mb-2">{{ 'Airlines' if lang != 'he' else '×—×‘×¨×•×ª ×ª×¢×•×¤×”' }}</h6>
        <div class="d-flex align-items-center gap-2 small text-muted mb-2">
          <span class="lowcost-dot m-0"></span>
          <span>{{ '×œ×•××•-×§×•×¡×˜' if lang == 'he' else 'Low-cost airline' }}</span>
        </div>
        <div id="airlines-chips" class="d-flex flex-wrap gap-2"></div>
      </div>

      <!-- Ad Widget -->
      <div id="ad-container" class="card mt-4 shadow-sm d-none fade-in-up" aria-label="Flightstoshow">
        <div id="ad-header" class="card-header bg-light small text-muted fw-semibold border-0">
          <i class="bi bi-airplane-engines me-1 text-primary"></i>
          {{ 'Direct Flight Deals' if lang != 'he' else '××‘×¦×¢×™ ×˜×™×¡×•×ª ×™×©×™×¨×•×ª' }}
        </div>
        <div class="card-body text-center p-0" id="ad-body"></div>
      </div>

      <!-- ATTRACTIONS CATEGORY BUTTONS -->
      <div id="weather-container" class="mt-4 d-none fade-in-up">
        <div class="weather-card mx-auto" style="max-width: 320px;">
          <h6 class="text-center text-muted small text-uppercase mb-3">
            ğŸŒ¤ï¸ {{ 'Weather Forecast' if lang != 'he' else '×ª×—×–×™×ª ××–×’ ××•×•×™×¨' }}
          </h6>
          <div id="weather-display" class="d-flex justify-content-center align-items-center gap-3"></div>
        </div>
      </div>

      <div class="mb-3 d-none" id="attractions-category-container">

        <!-- AI Itinerary Button -->
        <div class="text-center mb-4 fade-in-up mt-5">
          <button id="btn-generate-itinerary" class="btn btn-gradient-primary btn-lg shadow-sm rounded-pill px-4">
            <i class="bi bi-stars"></i> {{ 'Generate 3-Day Itinerary (AI)' if lang != 'he' else '×¦×•×¨ ××¡×œ×•×œ ×˜×™×•×œ ×œ-3 ×™××™×
            (AI)' }}
          </button>
        </div>

        <label class="form-label">
          ğŸ—ºï¸ {{ 'What do you want to explore?' if lang != 'he' else '××” ×ª×¨×¦×• ×œ×—×§×•×¨?' }}
        </label>

        <div id="attraction-buttons" class="d-flex flex-wrap gap-2">
          <button data-cat="" class="attr-btn active">ğŸ“Œ {{ 'All' if lang != 'he' else '×”×›×œ' }}</button>
          <button data-cat="museums" class="attr-btn">ğŸ–¼ï¸ {{ 'Museums' if lang != 'he' else '××•×–×™××•× ×™×' }}</button>
          <button data-cat="parks" class="attr-btn">ğŸŒ³ {{ 'Parks' if lang != 'he' else '×¤××¨×§×™×' }}</button>
          <button data-cat="landmarks" class="attr-btn">ğŸ—½ {{ 'Landmarks' if lang != 'he' else '× ×§×•×“×•×ª ×¦×™×•×Ÿ' }}</button>
          <button data-cat="religious" class="attr-btn">â›ª {{ 'Religious' if lang != 'he' else '××ª×¨×™× ×“×ª×™×™×' }}</button>
          <button data-cat="beaches" class="attr-btn">ğŸ–ï¸ {{ 'Beaches' if lang != 'he' else '×—×•×¤×™×' }}</button>
          <button data-cat="castles" class="attr-btn">ğŸ° {{ 'Castles' if lang != 'he' else '×˜×™×¨×•×ª' }}</button>
          <button data-cat="zoo" class="attr-btn">ğŸ… {{ 'Zoo' if lang != 'he' else '×’×Ÿ ×—×™×•×ª' }}</button>
          <button data-cat="aquarium" class="attr-btn">ğŸ  {{ 'Aquarium' if lang != 'he' else '××§×•×•×¨×™×•×' }}</button>
          <button data-cat="viewpoints" class="attr-btn">ğŸŒ„ {{ 'Viewpoints' if lang != 'he' else '×ª×¦×¤×™×•×ª' }}</button>
        </div>
      </div>

      <!-- ATTRACTIONS RESULT LIST -->
      <div id="attractions-container" class="mt-4 d-none">
        <h6>ğŸ—ºï¸ {{ 'Attractions' if lang != 'he' else '××˜×¨×§×¦×™×•×ª' }}</h6>
        <ul id="attractions-list" class="list-group"></ul>
      </div>

    </div>
  </div>
</div>

<!-- ITINERARY MODAL -->
<div class="modal fade" id="itineraryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="itineraryModalTitle">
          <i class="bi bi-map-fill me-2"></i>3-Day Itinerary
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4" id="itineraryModalBody">
        <!-- Content injected via JS -->
      </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          {{ 'Close' if lang != 'he' else '×¡×’×•×¨' }}
        </button>
        <button type="button" class="btn btn-primary" id="btn-copy-itinerary">
          <i class="bi bi-clipboard me-1"></i> {{ 'Copy' if lang != 'he' else '×”×¢×ª×§' }}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const lang = "{{ lang or 'en' }}";
    const countrySelect = document.getElementById("country");
    const citySelect = document.getElementById("city");
    const airportSelect = document.getElementById("airport");
    const cityContainer = document.getElementById("city-container");
    const airportContainer = document.getElementById("airport-container");
    const warningContainer = document.getElementById("warning-container");
    const warningMessage = document.getElementById("warning-message");
    const airlinesContainer = document.getElementById("airlines-container");
    const airlinesChips = document.getElementById("airlines-chips");

    const weatherContainer = document.getElementById("weather-container");
    const weatherDisplay = document.getElementById("weather-display");

    const adContainer = document.getElementById("ad-container");
    const adBody = document.getElementById("ad-body");
    const adHeader = document.getElementById("ad-header");

    let currentAirportData = [];
    let cityCoordinates = {};

    const t = {
      choose_city: lang === "he" ? "×‘×—×¨×• ×¢×™×¨" : "Choose a city",
      choose_airport: lang === "he" ? "×‘×—×¨×• ×©×“×” ×ª×¢×•×¤×”" : "Choose an airport",
      travel_warning: lang === "he" ? "××–×”×¨×ª ××¡×¢" : "Travel Warning",
      no_airlines: lang === "he" ? "××™×Ÿ ×—×‘×¨×•×ª ×ª×¢×•×¤×” ×¤×¢×™×œ×•×ª" : "No airlines available",
      loading_weather: lang === "he" ? "×˜×•×¢×Ÿ ××–×’ ××•×•×™×¨..." : "Loading weather...",
    };

    // ------------------------------------
    // WEATHER MAPPING
    // ------------------------------------
    function getWeatherIcon(code) {
      // WMO Weather interpretation codes (WW)
      // 0: Clear sky
      // 1, 2, 3: Mainly clear, partly cloudy, and overcast
      // 45, 48: Fog and depositing rime fog
      // 51, 53, 55: Drizzle: Light, moderate, and dense intensity
      // 56, 57: Freezing Drizzle: Light and dense intensity
      // 61, 63, 65: Rain: Slight, moderate and heavy intensity
      // 66, 67: Freezing Rain: Light and heavy intensity
      // 71, 73, 75: Snow fall: Slight, moderate, and heavy intensity
      // 77: Snow grains
      // 80, 81, 82: Rain showers: Slight, moderate, and violent
      // 85, 86: Snow showers slight and heavy
      // 95: Thunderstorm: Slight or moderate
      // 96, 99: Thunderstorm with slight and heavy hail

      const icons = {
        0: "bi-brightness-high",
        1: "bi-cloud-sun",
        2: "bi-cloud",
        3: "bi-clouds",
        45: "bi-cloud-haze",
        48: "bi-cloud-haze",
        51: "bi-cloud-drizzle",
        53: "bi-cloud-drizzle",
        55: "bi-cloud-drizzle-fill",
        56: "bi-cloud-drizzle",
        57: "bi-cloud-drizzle-fill",
        61: "bi-cloud-rain",
        63: "bi-cloud-rain-fill",
        65: "bi-cloud-rain-heavy-fill",
        66: "bi-cloud-hail",
        67: "bi-cloud-hail",
        71: "bi-snow",
        73: "bi-snow",
        75: "bi-snow2",
        77: "bi-snow",
        80: "bi-cloud-rain",
        81: "bi-cloud-rain-fill",
        82: "bi-cloud-rain-heavy-fill",
        85: "bi-snow",
        86: "bi-snow2",
        95: "bi-cloud-lightning",
        96: "bi-cloud-lightning-rain",
        99: "bi-cloud-lightning-rain-fill"
      };

      return icons[code] || "bi-cloud-sun";
    }

    async function fetchWeather(lat, lon) {
      if (lat == null || lon == null) {
        weatherContainer.classList.add("d-none");
        weatherContainer.classList.remove("fade-in-up"); // Reset animation
        return;
      }

      weatherDisplay.innerHTML = `<div class="spinner-border text-primary spinner-border-sm" role="status"></div>`;
      weatherContainer.classList.remove("d-none");
      weatherContainer.classList.add("fade-in-up"); // Trigger animation

      try {
        const res = await fetch(`/api/weather?lat=${lat}&lon=${lon}`);
        if (!res.ok) throw new Error("Weather fetch failed");

        const data = await res.json();
        // Expecting Open-Meteo format:
        // { daily: { weathercode: [...], temperature_2m_max: [...], temperature_2m_min: [...] } }

        if (data && data.daily && data.daily.weathercode && data.daily.weathercode.length > 0) {
          const code = data.daily.weathercode[0];
          const maxTemp = Math.round(data.daily.temperature_2m_max[0]);
          const minTemp = Math.round(data.daily.temperature_2m_min[0]);

          const iconClass = getWeatherIcon(code);

          weatherDisplay.innerHTML = `
                  <div class="text-center">
                      <i class="bi ${iconClass} display-4 text-primary mb-2 d-block"></i>
                      <div class="fw-bold fs-4">
                          ${maxTemp}Â° <span class="text-muted fs-6 align-top">/ ${minTemp}Â°</span>
                      </div>
                  </div>
              `;
        } else {
          weatherContainer.classList.add("d-none");
          weatherContainer.classList.remove("fade-in-up");
        }
      } catch (e) {
        console.error("Weather error:", e);
        weatherContainer.classList.add("d-none");
        weatherContainer.classList.remove("fade-in-up");
      }
    }


    // ------------------------------------
    // TRAVEL WARNINGS
    // ------------------------------------
    async function showTravelWarnings(country) {
      const warnRes = await fetch(`/api/warnings?country=${encodeURIComponent(country)}`);
      const warnData = await warnRes.json();

      if (warnData.warnings && warnData.warnings.length > 0) {
        const messages = warnData.warnings.map(w => {
          const safeText = w.recommendations || "âš ï¸ Travel advisory issued.";
          const safeLink = w.link
            ? `<a href="${w.link}" target="_blank" rel="noopener noreferrer" class="ms-1 text-decoration-underline fw-bold">[More info]</a>`
            : "";

          let formattedDate = "";
          if (w.date) {
            const dateObj = new Date(w.date);
            if (!isNaN(dateObj)) {
              formattedDate = dateObj.toLocaleDateString(lang === "he" ? "he-IL" : "en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              });
              formattedDate = `<div class="text-muted small mt-1">${formattedDate}</div>`;
            }
          }

          return `<div class="mb-2 border-bottom pb-2 last-no-border">${safeText} ${safeLink}${formattedDate}</div>`;
        }).join("");

        warningMessage.innerHTML = messages;
        warningContainer.classList.remove("d-none");
        warningContainer.classList.add("fade-in-up");
      } else {
        warningMessage.innerHTML = "";
        warningContainer.classList.add("d-none");
        warningContainer.classList.remove("fade-in-up");
      }
    }

    // ------------------------------------
    // COUNTRY â†’ CITIES
    // ------------------------------------
    countrySelect.addEventListener("change", async () => {
      const country = countrySelect.value;
      resetBelow("country");

      if (country) {
        const res = await fetch(`/api/cities?country=${encodeURIComponent(country)}`);
        const data = await res.json();

        citySelect.innerHTML = `<option value="" selected disabled>${lang === 'he' ? '×‘×—×¨×• ×¢×™×¨...' : 'Select a city...'}</option>`;
        cityCoordinates = {}; // Reset coords

        data.cities.forEach(cityObj => {
          // Handle both old format (string) and new format (object)
          let name, lat, lon;
          if (typeof cityObj === 'string') {
            name = cityObj;
            lat = null;
            lon = null;
          } else {
            name = cityObj.name;
            lat = cityObj.lat;
            lon = cityObj.lon;
          }

          citySelect.innerHTML += `<option value="${name}">${name}</option>`;
          if (lat != null && lon != null) {
            cityCoordinates[name] = { lat, lon };
          }
        });

        cityContainer.classList.remove("d-none");
        cityContainer.classList.add("fade-in-up");

        if (data.cities.length === 1) {
          // Auto-select if only one city
          const firstCity = typeof data.cities[0] === 'string' ? data.cities[0] : data.cities[0].name;
          citySelect.value = firstCity;
          citySelect.dispatchEvent(new Event("change"));
        }

        await showTravelWarnings(country);
      }
    });

    // ------------------------------------
    // CITY â†’ AIRPORTS + SHOW ATTRACTIONS + WEATHER
    // ------------------------------------
    citySelect.addEventListener("change", async () => {
      const country = countrySelect.value;
      const city = citySelect.value;
      resetBelow("city");

      if (city) {
        const res = await fetch(`/api/airports?country=${encodeURIComponent(country)}&city=${encodeURIComponent(city)}`);
        const data = await res.json();
        currentAirportData = data.airports;

        airportSelect.innerHTML = `<option value="" selected disabled>${lang === 'he' ? '×‘×—×¨×• ×©×“×”...' : 'Select an airport...'}</option>`;
        data.airports.forEach(airport => {
          airportSelect.innerHTML += `<option value="${airport.iata}">${airport.name} (${airport.iata})</option>`;
        });
        airportContainer.classList.remove("d-none");
        airportContainer.classList.add("fade-in-up");

        // --- ENABLE ATTRACTIONS ---
        currentCityName = city;
        attractionsCategoryContainer.classList.remove("d-none");
        attractionsCategoryContainer.classList.add("fade-in-up");
        loadAttractions();

        // --- SHOW WEATHER ---
        if (cityCoordinates[city]) {
          fetchWeather(cityCoordinates[city].lat, cityCoordinates[city].lon);
        }

        if (data.airports.length === 1) {
          airportSelect.value = data.airports[0].iata;
          airportSelect.dispatchEvent(new Event("change"));
        }
      }
    });

    // ------------------------------------
    // AIRPORT â†’ AIRLINES + ADS
    // ------------------------------------
    airportSelect.addEventListener("change", () => {
      const selectedIATA = airportSelect.value;
      const selected = currentAirportData.find(a => a.iata === selectedIATA);
      const cityName = citySelect.value;

      airlinesChips.innerHTML = "";

      if (selected && selected.airlines && selected.airlines.length > 0) {
        selected.airlines.forEach((airline, index) => {
          const chip = document.createElement("a");

          // Use official website if available, otherwise fallback to Google Search
          if (selected.airline_websites && selected.airline_websites[index]) {
            chip.href = selected.airline_websites[index];
            chip.title = `Visit ${airline} website`;
          } else {
            chip.href = `https://www.google.com/search?q=${encodeURIComponent(airline)}`;
            chip.title = `Search for ${airline} on Google`;
          }

          chip.target = "_blank";
          chip.rel = "noopener noreferrer";

          // Exact same class as index.html
          chip.className = "airline-chip text-decoration-none";

          // 1. Logo (Optional)
          if (selected.airline_codes && selected.airline_codes[index]) {
            const code = selected.airline_codes[index].toLowerCase();
            const img = document.createElement("img");
            img.src = `/static/airlines_logo/airline_logos/${code}.webp`;
            img.alt = airline;
            img.className = "airline-logo-sm me-1";
            img.style.height = "16px";
            img.style.width = "auto";
            img.style.verticalAlign = "middle";
            img.onerror = function () { this.style.display = 'none'; };
            chip.appendChild(img);
          }

          // 2. Lowcost Dot (Optional)
          if (selected.airline_lowcost && selected.airline_lowcost[index]) {
            const dot = document.createElement("span");
            dot.className = "lowcost-dot";
            dot.style.marginRight = "5px";
            dot.style.marginLeft = "2px";
            chip.appendChild(dot);
          }

          // 3. Name
          const textNode = document.createTextNode(airline);
          chip.appendChild(textNode);

          // External link icon
          const icon = document.createElement("i");
          icon.className = "bi bi-box-arrow-up-right ms-1";
          icon.style.fontSize = "0.85em";
          chip.appendChild(icon);

          airlinesChips.appendChild(chip);
        });
        airlinesContainer.classList.remove("d-none");
        airlinesContainer.classList.add("fade-in-up");
      } else {
        airlinesContainer.classList.add("d-none");
        airlinesContainer.classList.remove("fade-in-up");
        airlinesChips.innerHTML = `<span class="text-muted small">${t.no_airlines}</span>`;
      }

      if (!selectedIATA) {
        adContainer.classList.add("d-none");
        adContainer.classList.remove("fade-in-up");
        adBody.innerHTML = "";
        return;
      }

      adHeader.innerHTML =
        lang === "he"
          ? `<i class="bi bi-airplane-engines me-1 text-primary"></i> ××‘×¦×¢×™ ×˜×™×¡×•×ª ××ª×œ ××‘×™×‘ ××œ ${cityName}`
          : `<i class="bi bi-airplane-engines me-1 text-primary"></i> Direct Flight Deals from TLV to ${cityName}`;

      const localeParam = lang === 'he' ? 'he' : 'en';

      const scriptUrl = `https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.questionnar&searchUrl=www.aviasales.com%2Fsearch&locale=${localeParam}&powered_by=true&origin=TLV&destination=${selected.iata}&one_way=false&only_direct=true&period=year&range=7%2C14&primary=%230C73FE&color_background=%23ffffff&dark=%23000000&light=%23FFFFFF&achieve=%230F57C9ff&promo_id=4041&campaign_id=100`;

      adBody.innerHTML = "";
      const script = document.createElement("script");
      script.src = scriptUrl;
      script.async = true;
      script.charset = "utf-8";
      adBody.appendChild(script);

      adContainer.classList.remove("d-none");
      adContainer.classList.add("fade-in-up");
    });

    // ------------------------------------
    // ATTRACTIONS FEATURE
    // ------------------------------------
    // ------------------------------------
    // ATTRACTIONS FEATURE (CACHED + FAST)
    // ------------------------------------
    const attractionButtons = document.getElementById("attraction-buttons");
    const attractionsList = document.getElementById("attractions-list");
    const attractionsContainer = document.getElementById("attractions-container");
    const attractionsCategoryContainer = document.getElementById("attractions-category-container");

    let currentCategory = "";
    let currentCityName = "";
    let cachedAttractions = [];   // â† STORE ONCE

    async function loadAttractions() {
      if (!currentCityName) return;

      // if cache empty â†’ call API once
      if (cachedAttractions.length === 0) {
        attractionsList.innerHTML = `
      <li class="list-group-item text-muted border-0 bg-transparent">
        <div class="spinner-border spinner-border-sm text-primary" role="status"></div> 
        ${lang === "he" ? "×˜×¢×™× ×ª ××˜×¨×§×¦×™×•×ª..." : "Loading attractions..."}
      </li>
    `;

        try {
          const res = await fetch(`/api/attractions?city=${encodeURIComponent(currentCityName)}`);
          const data = await res.json();
          cachedAttractions = data.results || [];
        } catch (e) {
          console.error("Attractions error:", e);
          cachedAttractions = [];
        }
      }

      renderAttractions();
    }

    function renderAttractions() {
      let filtered = cachedAttractions;

      if (currentCategory) {
        filtered = cachedAttractions.filter(a => a.category === currentCategory);
      }

      attractionsList.innerHTML = "";

      if (filtered.length === 0) {
        attractionsList.innerHTML = `
      <li class="list-group-item text-muted border-0 bg-transparent text-center">
        ${lang === "he" ? "×œ× × ××¦××• ××˜×¨×§×¦×™×•×ª." : "No attractions found."}
      </li>`;
        attractionsContainer.classList.remove("d-none");
        attractionsContainer.classList.add("fade-in-up");
        return;
      }

      filtered.forEach(a => {
        const title = a.title || "";
        const extract = a.extract || "";
        const thumb = a.thumbnail || "";
        const wikiUrl = a.url || "#";
        const category = a.category || "";
        const lat = a.lat;
        const lon = a.lon;

        const maps = lat && lon ? `
      <div class="d-flex gap-2 mt-2">
        <a href="https://www.google.com/maps?q=${lat},${lon}" target="_blank" class="btn btn-sm btn-outline-primary shadow-sm"><i class="bi bi-google"></i> Maps</a>
        <a href="https://waze.com/ul?ll=${lat}%2C${lon}&navigate=yes" target="_blank" class="btn btn-sm btn-outline-info shadow-sm"><i class="bi bi-car-front-fill"></i> Waze</a>
      </div>
    ` : "";

        attractionsList.innerHTML += `
      <li class="list-group-item border-0 shadow-sm mb-3 rounded-3 p-3">
        <div class="d-flex">
          ${thumb ? `<img src="${thumb}" class="rounded-3 me-3 shadow-sm" style="width:90px;height:90px;object-fit:cover;">` : ""}

          <div class="flex-grow-1">
            <h6 class="mb-1 text-dark fw-bold">${title}</h6>
            <div class="small text-muted mb-2"><i class="bi bi-tag-fill"></i> ${category}</div>
            ${extract ? `<p class="mt-2 mb-2 text-secondary small">${extract}</p>` : ""}
            <div class="d-flex justify-content-between align-items-center mt-2">
                 <a href="${wikiUrl}" target="_blank" class="text-primary small text-decoration-none fw-semibold">
                  ${lang === "he" ? "×§×¨× ×¢×•×“ ×‘×•×™×§×™×¤×“×™×”" : "Read on Wikipedia"} <i class="bi bi-arrow-right-short"></i>
                </a>
                ${maps}
            </div>
          </div>
        </div>
      </li>
    `;
      });

      attractionsContainer.classList.remove("d-none");
      attractionsContainer.classList.add("fade-in-up");
    }


    // category button click
    attractionButtons.addEventListener("click", (e) => {
      if (!e.target.classList.contains("attr-btn")) return;

      attractionButtons.querySelectorAll(".attr-btn").forEach(btn =>
        btn.classList.remove("active")
      );
      e.target.classList.add("active");

      currentCategory = e.target.dataset.cat;

      renderAttractions(); // â† NO API CALL, ONLY FILTER
    });


    // ------------------------------------
    // RESET UI
    // ------------------------------------
    function resetBelow(level) {
      // Reset attractions cache ALWAYS
      cachedAttractions = [];
      currentCategory = "";
      currentCityName = "";

      if (level === "country") {
        cityContainer.classList.add("d-none");
        cityContainer.classList.remove("fade-in-up");
        citySelect.innerHTML = "";
        resetBelow("city");
      }

      if (level === "city") {
        airportContainer.classList.add("d-none");
        airportContainer.classList.remove("fade-in-up");
        airportSelect.innerHTML = "";
        warningContainer.classList.add("d-none");
        warningContainer.classList.remove("fade-in-up");
        warningMessage.innerHTML = "";
        airlinesContainer.classList.add("d-none");
        airlinesContainer.classList.remove("fade-in-up");

        airlinesChips.innerHTML = "";
        adContainer.classList.add("d-none");
        adContainer.classList.remove("fade-in-up");
        adBody.innerHTML = "";

        attractionsCategoryContainer.classList.add("d-none");
        attractionsCategoryContainer.classList.remove("fade-in-up");
        attractionsContainer.classList.add("d-none");
        attractionsContainer.classList.remove("fade-in-up");
        attractionsList.innerHTML = "";

        // Hide weather on reset
        weatherContainer.classList.add("d-none");
        weatherContainer.classList.remove("fade-in-up");
        weatherDisplay.innerHTML = "";
      }
    }


    // ------------------------------------
    // AI ITINERARY GENERATOR
    // ------------------------------------
    const btnGenerateItinerary = document.getElementById("btn-generate-itinerary");
    const itineraryModal = new bootstrap.Modal(document.getElementById('itineraryModal'));
    const itineraryModalBody = document.getElementById("itineraryModalBody");
    const itineraryModalTitle = document.getElementById("itineraryModalTitle");

    btnGenerateItinerary.addEventListener("click", async () => {
      if (!currentCityName) return;

      const country = countrySelect.value;
      const loadingText = lang === "he"
        ? "âœ¨ ×”-AI ×©×œ× ×• ××ª×›× ×Ÿ ××ª ×”×˜×™×•×œ ×”××•×©×œ× ×¢×‘×•×¨×š..."
        : "âœ¨ Our AI is planning your perfect trip...";

      itineraryModalBody.innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
            <h5 class="text-muted animate-pulse">${loadingText}</h5>
        </div>
      `;

      itineraryModalTitle.innerText = lang === "he"
        ? `××¡×œ×•×œ ×˜×™×•×œ ×œ-3 ×™××™× - ${currentCityName}`
        : `3-Day Itinerary for ${currentCityName}`;

      itineraryModal.show();

      try {
        const response = await fetch("/api/generate-itinerary", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            city: currentCityName,
            country: country,
            interests: [] // Can add interest selection later
          })
        });

        if (!response.ok) throw new Error("API Error");

        const data = await response.json();
        renderItinerary(data);

      } catch (e) {
        console.error("Itinerary Generation Error:", e);
        itineraryModalBody.innerHTML = `
            <div class="text-center py-5 text-danger">
                <i class="bi bi-exclamation-triangle display-1 mb-3"></i>
                <h5>${lang === "he" ? "××•×¤×¡! ×œ× ×”×¦×œ×—× ×• ×œ×™×™×¦×¨ ××ª ×”××¡×œ×•×œ ×›×¨×’×¢." : "Oops! Could not generate itinerary at the moment."}</h5>
                <p class="text-muted">${lang === "he" ? "× × ×œ× ×¡×•×ª ×©× ×™×ª ×××•×—×¨ ×™×•×ª×¨." : "Please try again later."}</p>
            </div>
        `;
      }
    });

    function renderItinerary(data) {
      if (!data.days) return;

      let html = '<div class="itinerary-timeline">';

      data.days.forEach(day => {
        html += `
                <div class="card mb-3 border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom-0 pt-3 pb-0">
                        <h5 class="text-primary fw-bold mb-0">
                            <span class="badge bg-primary me-2">${lang === "he" ? "×™×•×" : "Day"} ${day.day}</span>
                            ${day.theme || ""}
                        </h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item border-0 ps-0">
                                <i class="bi bi-brightness-alt-high-fill text-warning me-2"></i>
                                <strong>${lang === "he" ? "×‘×•×§×¨" : "Morning"}:</strong> ${day.morning}
                            </li>
                            <li class="list-group-item border-0 ps-0">
                                <i class="bi bi-sun-fill text-orange me-2"></i>
                                <strong>${lang === "he" ? "×¦×”×¨×™×™×" : "Afternoon"}:</strong> ${day.afternoon}
                            </li>
                            <li class="list-group-item border-0 ps-0">
                                <i class="bi bi-moon-stars-fill text-dark me-2"></i>
                                <strong>${lang === "he" ? "×¢×¨×‘" : "Evening"}:</strong> ${day.evening}
                            </li>
                        </ul>
                    </div>
                </div>
            `;
      });

      html += '</div>';

      // Add a "Copy" or "Share" hint maybe?
      itineraryModalBody.innerHTML = html;
    }

    // ------------------------------------
    // COPY ITINERARY
    // ------------------------------------
    const btnCopyItinerary = document.getElementById("btn-copy-itinerary");
    if (btnCopyItinerary) {
      btnCopyItinerary.addEventListener("click", () => {
        const text = itineraryModalBody.innerText;
        navigator.clipboard.writeText(text).then(() => {
          const originalText = btnCopyItinerary.innerHTML;
          btnCopyItinerary.innerHTML = `<i class="bi bi-check2"></i> ${lang === "he" ? "×”×•×¢×ª×§!" : "Copied!"}`;
          setTimeout(() => {
            btnCopyItinerary.innerHTML = originalText;
          }, 2000);
        }).catch(err => {
          console.error('Failed to copy: ', err);
        });
      });
    }

  });
</script>

<style>
  /* -----------------------------------------
   âœ¨ ANIMATIONS
----------------------------------------- */
  @keyframes fade-in-up {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }

    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .fade-in-up {
    animation: fade-in-up 0.4s ease-out forwards;
  }

  /* -----------------------------------------
   âœ¨ WEATHER WIDGET
----------------------------------------- */
  .weather-card {
    background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.5);
    transition: transform 0.2s ease;
  }

  .weather-card:hover {
    transform: translateY(-2px);
  }

  /* Dark mode weather */
  body.dark-mode .weather-card {
    background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
    border-color: #444;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }

  /* -----------------------------------------
   âœ¨ FORM & CARDS
----------------------------------------- */
  .form-floating>.form-select {
    height: 5rem !important;
    padding-top: 2rem;
    padding-bottom: 0.625rem;
    font-size: 1.15rem;
  }

  .card {
    border: none;
  }

  /* Ad fade-in */
  #ad-container {
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  #ad-container:not(.d-none) {
    opacity: 1;
  }

  /* ğŸŒ™ Dark-mode fixes for Travel Questionnaire */
  body.dark-mode select.form-select,
  body.dark-mode input.form-control,
  body.dark-mode textarea.form-control {
    background-color: #1e1e1e !important;
    color: #f1f1f1 !important;
    border-color: #444 !important;
  }

  body.dark-mode .form-floating>label {
    color: #aaa;
  }

  body.dark-mode select.form-select:focus,
  body.dark-mode input.form-control:focus,
  body.dark-mode textarea.form-control:focus {
    background-color: #252525 !important;
    color: #fff !important;
    border-color: #3a8bff !important;
    box-shadow: 0 0 0 0.15rem rgba(50, 168, 221, 0.3);
  }

  body.dark-mode option {
    background-color: #1e1e1e;
    color: #f1f1f1;
  }

  /* Fix floating label background in dark mode */
  body.dark-mode .form-floating>label::after {
    background-color: #1e1e1e !important;
    color: #aaa;
  }



  /* Dark mode warning alert */
  body.dark-mode .alert-warning {
    background-color: #2e2a00 !important;
    color: #ffe082 !important;
    border-color: #554d00 !important;
  }

  /* Dark-mode cards */
  body.dark-mode .card {
    background-color: #181818 !important;
    border-color: #2a2a2a !important;
  }

  body.dark-mode .card-header {
    background-color: #0d6efd !important;
    color: #fff !important;
  }

  body.dark-mode label.form-label,
  body.dark-mode h5,
  body.dark-mode h6 {
    color: #e0e0e0 !important;
  }

  /* -----------------------------------------
   âœ¨ ATTRACTIONS â€” BUTTON STYLES
----------------------------------------- */
  .attr-btn {
    border: 1px solid rgba(124, 58, 237, .35);
    background: rgba(124, 58, 237, .12);
    padding: 8px 16px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 500;
    white-space: nowrap;
    transition: all 0.3s ease;
    box-shadow: none;
    color: inherit;
  }

  .attr-btn:hover {
    background: var(--accent);
    /* Uses app.css accent */
    color: #fff;
    transform: translateY(-2px) scale(1.05);
    /* Match chip hover */
    box-shadow: var(--accent-glow);
    border-color: transparent;
  }

  .attr-btn.active {
    background: var(--accent);
    color: white;
    border-color: transparent;
    box-shadow: var(--accent-glow);
  }

  /* Dark mode attraction buttons - remove specific overrides to let them behave like chips */
  body.dark-mode .attr-btn {
    background: rgba(124, 58, 237, .15);
    border-color: rgba(124, 58, 237, .4);
    color: #e0e0e0;
  }

  body.dark-mode .attr-btn:hover,
  body.dark-mode .attr-btn.active {
    background: var(--accent);
    color: #fff;
    border-color: transparent;
  }

  /* Attractions list */
  #attractions-list .list-group-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #fff;
    /* Ensure white background */
    color: #000 !important;
    /* Ensure black text */
  }

  #attractions-list .list-group-item h6 {
    color: #000 !important;
  }

  #attractions-list .list-group-item .text-muted {
    color: #6c757d !important;
    /* Keep muted text gray */
  }

  body.dark-mode #attractions-list .list-group-item {
    background-color: #202020;
    color: #f1f1f1 !important;
    border-color: #303030;
  }

  body.dark-mode #attractions-list .list-group-item h6 {
    color: #f1f1f1 !important;
  }

  body.dark-mode #attractions-list .list-group-item .text-muted {
    color: #adb5bd !important;
  }
</style>
{% endblock %}
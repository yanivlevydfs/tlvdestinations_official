{% extends "base.html" %}
{% block head %}

<link rel="stylesheet" href="{{ url_for('static', path='css/app.css') }}?v={{ time.time() }}">
  <!-- âœ… Page-specific SEO -->
  <meta name="description" content="Live flight statistics from Ben Gurion Airport (TLV). Explore the top destinations, airlines, countries, and cities with departures and arrivals updated in real-time.">
  <meta name="keywords" content="Ben Gurion Airport, TLV flights, flight statistics, top destinations, airlines, arrivals, departures, Tel Aviv flights">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
  <meta property="og:description" content="See live statistics from Ben Gurion Airport (TLV). Explore top countries, cities, and airlines for departures and arrivals.">
  <meta property="og:url" content="https://fly-tlv.com/destinations">
  <meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta property="og:image:alt" content="Ben Gurion Airport TLV statistics dashboard">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ben Gurion Airport â€” Current Flight Statistics | Fly-TLV">
  <meta name="twitter:description" content="Live departures and arrivals statistics from TLV airport. Updated charts with top destinations and airlines.">
  <meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta name="twitter:image:alt" content="TLV airport stats overview">
	<link rel="canonical" href="https://fly-tlv.com/destinations/{{ destination.IATA }}{{ '' if lang != 'he' else '?lang=he' }}" />
	<link rel="alternate" href="https://fly-tlv.com/destinations/{{ destination.IATA }}" hreflang="en" />
	<link rel="alternate" href="https://fly-tlv.com/destinations/{{ destination.IATA }}?lang=he" hreflang="he" />
	<link rel="alternate" href="https://fly-tlv.com/destinations/{{ destination.IATA }}" hreflang="x-default" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>	

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://fly-tlv.com/#org",
      "name": "Fly TLV",
      "url": "https://fly-tlv.com/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://fly-tlv.com/static/icons/favicon-512.png",
        "width": 512,
        "height": 512
      }
    },
    {
      "@type": "WebSite",
      "@id": "https://fly-tlv.com/#website",
      "name": "Fly TLV â€” Direct Destinations Explorer",
      "url": "https://fly-tlv.com/",
      "publisher": { "@id": "https://fly-tlv.com/#org" },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://fly-tlv.com/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@type": "WebPage",
      "@id": "https://fly-tlv.com/destinations/{{ destination.IATA }}/#page",
      "url": "https://fly-tlv.com/destinations/{{ destination.IATA }}{% if lang=='he' %}?lang=he{% endif %}",
      "name": "{% if lang!='he' %}Flights from Tel Aviv (TLV) to {{ destination.City }} ({{ destination.IATA }}){% else %}×˜×™×¡×•×ª ××ª×œ ××‘×™×‘ (TLV) ××œ {{ destination.City }}{% endif %}",
      "inLanguage": "{% if lang=='he' %}he-IL{% else %}en-US{% endif %}",
      "description": "{% if lang!='he' %}Explore direct flights from TLV to {{ destination.City }} â€” airlines, distance, flight time, map, and travel data.{% else %}×˜×™×¡×•×ª ×™×©×™×¨×•×ª ××ª×œ ××‘×™×‘ ××œ {{ destination.City }} â€” ×—×‘×¨×•×ª ×ª×¢×•×¤×”, ××¨×—×§, ×–××Ÿ ×˜×™×¡×” ×•××™×“×¢ ×©×™××•×©×™.{% endif %}",
      "publisher": { "@id": "https://fly-tlv.com/#org" },
      "isPartOf": { "@id": "https://fly-tlv.com/#website" }
    },
    {
      "@type": "Flight",
      "@id": "https://fly-tlv.com/#flight-{{ destination.IATA }}",
      "name": "TLV â†’ {{ destination.IATA }} Direct Flight",
      "provider": { "@id": "https://fly-tlv.com/#org" },
      "departureAirport": {
        "@type": "Airport",
        "name": "Ben Gurion Airport",
        "iataCode": "TLV",
        "geo": { "@type": "GeoCoordinates", "latitude": 32.0, "longitude": 34.87 }
      },
      "arrivalAirport": {
        "@type": "Airport",
        "name": "{{ destination.Airport }}",
        "iataCode": "{{ destination.IATA }}",
        "geo": {"@type": "GeoCoordinates","latitude": {{ destination.lat | default(0, true) }},"longitude": {{ destination.lon | default(0, true) }}
}
      },
      "flightDistance": {
        "@type": "QuantitativeValue",
        "value": {{ destination.Distance_km or 0 }},
        "unitText": "km"
      },
      "operatedBy": [
        {% for airline in destination.Airlines %}
        { "@type": "Airline", "name": "{{ airline | trim }}" }{% if not loop.last %},{% endif %}
        {% endfor %}
      ]
    },
    {
      "@type": "TouristDestination",
      "@id": "https://fly-tlv.com/#dest-{{ destination.IATA }}",
      "name": "{{ destination.City }}",
      "description": "Direct destination reachable from TLV.",
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": {{ destination.lat }},
        "longitude": {{ destination.lon }}
      },
      "containedInPlace": {
        "@type": "Country",
        "name": "{{ destination.Country }}"
      }
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "{% if lang!='he' %}Home{% else %}×‘×™×ª{% endif %}", "item": "https://fly-tlv.com/{% if lang=='he' %}?lang=he{% endif %}" },
        { "@type": "ListItem", "position": 2, "name": "{% if lang!='he' %}Destinations{% else %}×™×¢×“×™×{% endif %}", "item": "https://fly-tlv.com/destinations{% if lang=='he' %}?lang=he{% endif %}" },
        { "@type": "ListItem", "position": 3, "name": "{{ destination.City }} ({{ destination.IATA }})", "item": "https://fly-tlv.com/destinations/{{ destination.IATA }}{% if lang=='he' %}?lang=he{% endif %}" }
      ]
    },
    {
      "@type": "ItemList",
      "name": "Site Navigation",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "item": { "@type": "SiteNavigationElement", "name": "Home", "url": "https://fly-tlv.com/" } },
        { "@type": "ListItem", "position": 2, "item": { "@type": "SiteNavigationElement", "name": "×‘×™×ª", "url": "https://fly-tlv.com/?lang=he" } },
        { "@type": "ListItem", "position": 3, "item": { "@type": "SiteNavigationElement", "name": "Stats", "url": "https://fly-tlv.com/stats" } },
        { "@type": "ListItem", "position": 4, "item": { "@type": "SiteNavigationElement", "name": "× ×ª×•× ×™ ×©×“×”", "url": "https://fly-tlv.com/stats?lang=he" } },
        { "@type": "ListItem", "position": 5, "item": { "@type": "SiteNavigationElement", "name": "Flights", "url": "https://fly-tlv.com/flights" } },
        { "@type": "ListItem", "position": 6, "item": { "@type": "SiteNavigationElement", "name": "×˜×™×¡×•×ª", "url": "https://fly-tlv.com/flights?lang=he" } },
        { "@type": "ListItem", "position": 7, "item": { "@type": "SiteNavigationElement", "name": "World Map", "url": "https://fly-tlv.com/map" } },
        { "@type": "ListItem", "position": 8, "item": { "@type": "SiteNavigationElement", "name": "××¤×ª ×™×¢×“×™×", "url": "https://fly-tlv.com/map?lang=he" } },
        { "@type": "ListItem", "position": 9, "item": { "@type": "SiteNavigationElement", "name": "Travel Warnings", "url": "https://fly-tlv.com/travel-warnings" } },
        { "@type": "ListItem", "position": 10, "item": { "@type": "SiteNavigationElement", "name": "××–×”×¨×•×ª ××¡×¢", "url": "https://fly-tlv.com/travel-warnings?lang=he" } },
        { "@type": "ListItem", "position": 11, "item": { "@type": "SiteNavigationElement", "name": "Chat", "url": "https://fly-tlv.com/chat" } },
        { "@type": "ListItem", "position": 12, "item": { "@type": "SiteNavigationElement", "name": "×¦×³××˜", "url": "https://fly-tlv.com/chat?lang=he" } },
        { "@type": "ListItem", "position": 13, "item": { "@type": "SiteNavigationElement", "name": "About", "url": "https://fly-tlv.com/about" } },
        { "@type": "ListItem", "position": 14, "item": { "@type": "SiteNavigationElement", "name": "×¢×œ×™× ×•", "url": "https://fly-tlv.com/about?lang=he" } },
        { "@type": "ListItem", "position": 15, "item": { "@type": "SiteNavigationElement", "name": "Direct vs Nonstop", "url": "https://fly-tlv.com/direct-vs-nonstop" } },
        { "@type": "ListItem", "position": 16, "item": { "@type": "SiteNavigationElement", "name": "×™×©×™×¨ ××•×œ ×œ×œ×-×¢×¦×™×¨×•×ª", "url": "https://fly-tlv.com/direct-vs-nonstop?lang=he" } },
        { "@type": "ListItem", "position": 17, "item": { "@type": "SiteNavigationElement", "name": "Glossary", "url": "https://fly-tlv.com/glossary" } },
        { "@type": "ListItem", "position": 18, "item": { "@type": "SiteNavigationElement", "name": "××™×œ×•×Ÿ ××•× ×—×™×", "url": "https://fly-tlv.com/glossary?lang=he" } },
        { "@type": "ListItem", "position": 19, "item": { "@type": "SiteNavigationElement", "name": "Privacy Policy", "url": "https://fly-tlv.com/privacy" } },
        { "@type": "ListItem", "position": 20, "item": { "@type": "SiteNavigationElement", "name": "××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª", "url": "https://fly-tlv.com/privacy?lang=he" } },
        { "@type": "ListItem", "position": 21, "item": { "@type": "SiteNavigationElement", "name": "Accessibility", "url": "https://fly-tlv.com/accessibility" } },
        { "@type": "ListItem", "position": 22, "item": { "@type": "SiteNavigationElement", "name": "× ×’×™×©×•×ª", "url": "https://fly-tlv.com/accessibility?lang=he" } },
        { "@type": "ListItem", "position": 23, "item": { "@type": "SiteNavigationElement", "name": "Contact", "url": "https://fly-tlv.com/contact" } },
        { "@type": "ListItem", "position": 24, "item": { "@type": "SiteNavigationElement", "name": "×¦×•×¨ ×§×©×¨", "url": "https://fly-tlv.com/contact?lang=he" } },
        { "@type": "ListItem", "position": 25, "item": { "@type": "SiteNavigationElement", "name": "Sitemap", "url": "https://fly-tlv.com/sitemap.xml" } },
        { "@type": "ListItem", "position": 26, "item": { "@type": "SiteNavigationElement", "name": "××¤×ª ××ª×¨", "url": "https://fly-tlv.com/sitemap.xml?lang=he" } }
      ]
    }
  ]
}
</script>


<style>
/* Light hover effect (unchanged) */
.hover-opacity:hover {
  background-color: #f8f9fa;
  box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.04);
  opacity: 0.9;
}
/* âœ… GLOBAL dark mode base */
body.dark-mode {
  color: #ffffff;
  background-color: #121212;
}

/* âœ… Fix card background and text */
body.dark-mode .card,
body.dark-mode .card-header,
body.dark-mode .card-footer,
body.dark-mode .card-body {
  background-color: #1e1e1e !important;
  color: #ffffff !important;
  border-color: #2c2c2c !important;
}

/* âœ… Force ALL inner text to white, including <p>, <strong>, <small>, etc. */
body.dark-mode .card *,
body.dark-mode .card-body *,
body.dark-mode .card-body p,
body.dark-mode .card-body small,
body.dark-mode .card-body .small,
body.dark-mode .card-body strong,
body.dark-mode .card-body span {
  color: #ffffff !important;
}

/* âœ… Muted text should still be dimmed, but not black */
body.dark-mode .card-body .text-muted {
  color: #b0b0b0 !important;
}

/* âœ… Fix background and text inside Wikipedia box */
body.dark-mode #city-overview,
body.dark-mode .bg-light {
  background-color: #2a2a2a !important;
  color: #ffffff !important;
}

/* âœ… Form elements */
body.dark-mode select.form-select,
body.dark-mode input,
body.dark-mode textarea {
  background-color: #2a2a2a !important;
  color: #ffffff !important;
  border-color: #444 !important;
}
.country-badge {
  white-space: nowrap;
  line-height: 1.2;
}

/* ğŸ”¹ Mobile Fix */
@media (max-width: 576px) {
  .country-badge {
    display: inline-flex !important;
    font-size: 0.9rem;
    padding: 0.25rem 0.5rem !important;
  }
  .country-badge img {
    width: 18px !important;
    margin-left: 3px;
  }
  .card-header {
    flex-direction: column !important;
    text-align: center !important;
    gap: 6px !important;
  }
}

/* ============================================================
   Purple compact warning chip â€” EXACT airline chip style
   ============================================================ */
.warning-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;

    padding: 8px 14px;
    border-radius: 22px;

    background: rgba(112, 0, 150, 0.18);
    border: 1px solid rgba(112, 0, 150, 0.45);

    /* LIGHT MODE TEXT COLOR */
    color: #000 !important;

    font-size: 0.9rem;
    transition: all 0.2s ease-in-out;
}

.warning-chip:hover {
    background: rgba(112, 0, 150, 0.28);
    border-color: rgba(112, 0, 150, 0.65);
}

/* Icons + spans inside chip (LIGHT MODE) */
.warning-chip span,
.warning-chip i,
.warning-chip a {
    color: #000 !important;
}


/* ============================================================
   DARK MODE â€” everything white
   ============================================================ */
body.dark-mode .warning-chip,
body.dark-mode .warning-chip span,
body.dark-mode .warning-chip i,
body.dark-mode .warning-chip a {
    color: #fff !important;
}
</style>

{% endblock %}

{% block content %}

<div class="container mt-5">
  <div class="card shadow-lg">
    <!-- âœ… Button aligned right -->
<div class="card-body pt-3 pb-0">
  <div class="d-flex justify-content-between flex-wrap">
    <!-- Left: Back to questionnaire -->
    <a href="{{ '/travel-questionnaire' if lang != 'he' else '/travel-questionnaire?lang=he' }}"
       class="btn btn-outline-primary btn-sm"
       dir="{{ 'rtl' if lang == 'he' else 'ltr' }}">
      {% if lang == 'he' %}
        ğŸš€ ××“×¨×™×š × ×¡×™×¢×”
      {% else %}
        ğŸš€ Travel Guide
      {% endif %}
    </a>

    <!-- Right: Back to table -->
    <a href="{{ '/' if lang != 'he' else '/?lang=he' }}"
       class="btn btn-outline-primary btn-sm"
       dir="{{ 'rtl' if lang == 'he' else 'ltr' }}">
      {% if lang == 'he' %}
        ×—×–×¨×” ×œ×˜×‘×œ×” â†’
      {% else %}
        â† Back to table
      {% endif %}
    </a>
  </div>

	</div>
    <!-- âœ… Horizontal line divider -->
    <hr class="mt-2 mb-0">
    <!-- ğŸ”· Blue title/header bar -->
	<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center flex-wrap">
	  <h3 class="mb-0 fs-5">
		{{ 'TLV to' if lang != 'he' else '× ×ª×‘×´×’ ××œ' }} {{ destination.Name }} ({{ destination.IATA }})
	  </h3>
<span class="badge bg-light text-dark d-inline-flex align-items-center justify-content-center gap-1 px-2 py-1 flex-nowrap country-badge">
  <span>{{ destination.Country }}</span>
  {% if destination.CountryISO %}
    <img 
      src="https://flagcdn.com/24x18/{{ destination.CountryISO | lower }}.png"
      alt="{{ destination.Country or 'Country flag' }}"
      class="rounded shadow-sm"
      style="width: 22px; height: auto; object-fit: contain;"
    />
  {% endif %}
</span>
	</div>

    <!-- Body -->
<div class="card-body">
  <!-- Compact Quick info grid -->
<div class="row text-center mb-3 g-3 align-items-stretch">
  <div class="col-6 col-md-3 d-flex flex-column justify-content-center align-items-center">
    <i class="bi bi-geo-alt-fill text-danger" style="font-size: 1.6rem;"></i>
    <p class="mb-0 small mt-1"><strong>{{ destination.City }}</strong></p>
    <small class="text-muted">{{ 'City' if lang != 'he' else '×¢×™×¨' }}</small>
  </div>

  <div class="col-6 col-md-3 d-flex flex-column justify-content-center align-items-center">
    <i class="bi bi-signpost-split-fill text-success" style="font-size: 1.6rem;"></i>
    <p class="mb-0 small mt-1">{{ destination.IATA }}</p>
    <small class="text-muted">IATA</small>
  </div>

  <div class="col-6 col-md-3 d-flex flex-column justify-content-center align-items-center">
    <i class="bi bi-rulers text-primary" style="font-size: 1.6rem;"></i>
    <p class="mb-0 small mt-1">{{ "%.1f"|format(destination.Distance_km or 0) }} km</p>
    <small class="text-muted">{{ 'Distance' if lang != 'he' else '××¨×—×§' }}</small>
  </div>

  <div class="col-6 col-md-3 d-flex flex-column justify-content-center align-items-center">
    <i class="bi bi-clock-history text-warning" style="font-size: 1.6rem;"></i>
    <p class="mb-0 small mt-1">{{ destination.FlightTime_hr or "â€”" }}</p>
    <small class="text-muted">{{ 'Flight Time' if lang != 'he' else '××©×š ×˜×™×¡×”' }}</small>
  </div>
</div>

      <!-- Coordinates -->
      <p>
        <strong>{{ 'Coordinates' if lang != 'he' else '×§×•××•×¨×“×™× ×˜×•×ª' }}:</strong>
        {{ destination.lat }}, {{ destination.lon }}
      </p>
<div id="warning-container" 
     class="mt-4 d-none text-end"
     dir="rtl">

  <a class="warning-chip text-decoration-none">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>

      <!-- Hebrew warning text injected here -->
      <span id="warning-message"></span>

      <!-- external link icon shown only if needed -->
      <i class="bi bi-box-arrow-up-right ms-2 opacity-50" 
         id="warning-link-icon" 
         style="display:none;"></i>
  </a>

</div>

      <!-- Airlines -->
<h6 class="mt-4 mb-2 fw-semibold">
  <i class="bi bi-airplane-engines me-1 text-primary"></i>
  {{ 'Airlines' if lang != 'he' else '×—×‘×¨×•×ª ×ª×¢×•×¤×”' }}:
</h6>

{% if destination.Airlines %}
  <div class="d-flex flex-wrap gap-2">
    {% for airline in destination.Airlines %}
      {% set airline_name = airline.strip().title() %}
      {% set website = AIRLINE_WEBSITES.get(airline_name) %}
      {% if website %}
        <a href="{{ website }}"
           target="_blank"
           rel="noopener"
           class="airline-chip text-decoration-none"
           style="transition: all 0.2s ease-in-out;"
           title="Visit {{ airline_name | e }} website">
          <span>{{ airline_name }}</span>
          <i class="bi bi-box-arrow-up-right ms-2 opacity-50"></i>
        </a>
      {% else %}
        <a href="https://www.google.com/search?q={{ airline_name | urlencode }}"
           target="_blank"
           rel="noopener"
           class="airline-chip text-decoration-none"
           style="transition: all 0.2s ease-in-out;"
           title="Search for {{ airline_name | e }} on Google">
          <span>{{ airline_name }}</span>
          <i class="bi bi-search ms-2 opacity-50"></i>
        </a>
      {% endif %}
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">â€”</p>
{% endif %}

<div class="card shadow-sm d-none d-lg-block mt-4 mb-4" aria-label="Advertisement">
  <div class="card-header small text-muted fw-semibold">
    <i class="bi bi-airplane-engines me-1 text-primary"></i> Flight Search
  </div>
  <div class="card-body text-center p-0" style="overflow: hidden;">
	<script
	  async
	  src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.flight_bannerindex&show_hotels=true&powered_by=true&locale={{ 'he' if lang == 'he' else 'en' }}&searchUrl=www.aviasales.com%2Fsearch&primary_override=%2332a8dd&color_button=%2332a8dd&color_icons=%2332a8dd&dark=%23262626&light=%23FFFFFF&secondary=%23FFFFFF&special=%23C4C4C400&color_focused=%2332a8dd&border_radius=19&no_labels=true&plain=true&origin=TLV&destination={{ destination.IATA }}&promo_id=7879&campaign_id=100"
	  charset="utf-8">
	</script>
  </div>
</div>

      <!-- Wikipedia City Overview -->
      <div class="mt-2">
        <h5><i class="bi bi-info-circle"></i>
          {{ 'About ' ~ destination.City if lang != 'he' else '×¢×œ ' ~ destination.City }}
        </h5>
		<div id="city-overview" class="border rounded p-3 bg-light">
		  {% if wiki_summary and wiki_summary.extract %}
			<div class="row">
			  {% if wiki_summary.thumbnail %}
				<div class="col-12 col-md-auto text-center mb-3 mb-md-0">
				  <img src="{{ wiki_summary.thumbnail }}" alt="{{ wiki_summary.title }}" class="img-fluid rounded shadow-sm" style="max-width:180px;">
				</div>
			  {% endif %}
			  <div class="col">
				<strong>{{ wiki_summary.title }}</strong><br>
				{% if wiki_summary.description %}
				  <em>{{ wiki_summary.description }}</em><br>
				{% endif %}
				<p>{{ wiki_summary.extract }}</p>
				{% if wiki_summary.url %}
				  <a href="{{ wiki_summary.url }}" target="_blank" rel="noopener">
					ğŸŒ {{ '×§×¨× ×¢×•×“ ×‘×•×•×™×§×™×¤×“×™×”' if lang == 'he' else 'Read more on Wikipedia' }}
				  </a>
				{% endif %}
			  </div>
			</div>
		  {% else %}
			<div class="text-muted">
			  {{ '×œ× × ××¦× ××™×“×¢ ×‘×•×•×™×§×™×¤×“×™×”.' if lang == 'he' else 'No Wikipedia data found.' }}
			</div>
		  {% endif %}
		</div>
      </div>
	<!-- ğŸŒ¤ï¸ Weather for Destination -->
		<div class="mt-2">
		  <h5>
			<i class="bi bi-cloud-sun"></i>
			{{ ('Weather in ' if lang != 'he' else '××–×’ ×”××•×•×™×¨ ×‘Ö¾') ~ destination.City }}
		  </h5>

		  <div class="border rounded p-2 bg-light">
			<iframe
			  width="100%"
			  height="450"
			  frameborder="0"
			  src="https://embed.windy.com/embed2.html?lat={{ destination.lat }}&lon={{ destination.lon }}&detailLat={{ destination.lat }}&detailLon={{ destination.lon }}&width=100%&height=450&zoom=8&level=surface&overlay=wind&menu=&message=true&marker=&calendar=24&pressure=false&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1"
			  allowfullscreen
			  loading="lazy"
			  title="{{ destination.City }} Weather from Windy">
			</iframe>
		  </div>
		</div>
		<div class="card shadow-sm d-none d-lg-block mt-4 mb-4" aria-label="Advertisement">
		  <div class="card-header small text-muted fw-semibold">
			<i class="bi bi-sim-fill me-1 text-primary"></i>{{ 'Travel SIM Deals' if lang != 'he' else '×¢×¡×§××•×ª ×¡×™× ×œ×—×•×´×œ' }}
		  </div>
		  <div class="card-body text-center p-0" style="overflow: hidden;">
			<script
			  async
			  src="https://tpembd.com/content?trs=461563&shmarker=674907.destinationsim&locale={{ 'he' if lang == 'he' else 'en' }}&country={{ destination.Country | urlencode }}&powered_by=true&color_button=%2332a8dd&color_focused=%2332a8dd&secondary=%23FFFFFF&dark=%23262626&light=%23FFFFFF&special=%2300000000&border_radius=0&plain=false&no_labels=true&promo_id=8588&campaign_id=541"
			  charset="utf-8">
			  </script>
		  </div>
		</div>
		<div class="card shadow-sm d-none d-lg-block mt-4 mb-4" aria-label="Advertisement">
		  <div class="card-header small text-muted fw-semibold">
			<i class="bi bi-tags-fill me-1 text-primary"></i>{{ 'Flight Deals' if lang != 'he' else '××‘×¦×¢×™ ×˜×™×¡×•×ª' }}
		  </div>
		  <div class="card-body text-center p-0" style="overflow: hidden;">
			<script
			  async
			  src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.destinationsflights&color_button=%23045DA8ff&target_host=www.aviasales.com%2Fsearch&locale={{ 'he' if lang == 'he' else 'en' }}&powered_by=true&origin=TLV&destination={{ destination.IATA }}&with_fallback=true&non_direct_flights=false&min_lines=5&border_radius=0&color_background=%23FFFFFF&color_text=%23000000&color_border=%23FFFFFF&promo_id=2811&campaign_id=100"
			  charset="utf-8">
			</script>
		  </div>
		</div>
      <!-- Map -->
{% if destination.lat and destination.lon %}
  <div class="card shadow-sm mb-4 mt-4">
    <div class="card-header small text-muted fw-semibold d-flex justify-content-between align-items-center">
      <span><i class="bi bi-globe2 me-1 text-primary"></i>
        {{ 'Interactive Flight Map' if lang != 'he' else '××¤×ª ×˜×™×¡×•×ª ××™× ×˜×¨××§×˜×™×‘×™×ª' }}
      </span>
      <button class="btn btn-sm btn-outline-secondary d-lg-none" type="button"
              data-bs-toggle="collapse" data-bs-target="#flightMapWidget"
              aria-expanded="true" aria-controls="flightMapWidget">
        {{ 'Toggle Map' if lang != 'he' else '×”×¦×’/×”×¡×ª×¨ ××¤×”' }}
      </button>
    </div>
    <div class="card-body text-center p-0 collapse show d-lg-block" id="flightMapWidget" style="overflow: auto;">
	<script
	  async
	  src="https://tpembd.com/content?currency=ils&trs=461563&shmarker=674907.destinationsflights&lat={{ destination.lat }}&lng={{ destination.lon }}&powered_by=true&search_host=www.aviasales.com%2Fsearch&locale={{ 'he' if lang == 'he' else 'en' }}&origin=TLV&value_min=0&value_max=1000000&round_trip=true&only_direct=true&radius=1&draggable=true&disable_zoom=false&show_logo=false&scrollwheel=true&primary=%233FABDB&secondary=%233FABDB&light=%23ffffff&width=1500&height=500&zoom=5&promo_id=4054&campaign_id=100"
	  charset="utf-8">
	</script>
    </div>
  </div>
{% endif %}

{% if travel_info and travel_info['pois'] %}
  <div id="poi-list" class="card shadow-sm mt-4">
	<div class="card-header text-primary fw-semibold d-flex justify-content-between align-items-center">
	  <span>
		<i class="bi bi-stars me-1"></i>
		{{ 'Points of Interest' if lang != 'he' else '× ×§×•×“×•×ª ×¢× ×™×™×Ÿ' }}
	  </span>
	  <span class="badge bg-secondary">
		{{ travel_info['pois'] | length }}
	  </span>
	</div>
    <div class="card-body">
      <div class="row row-cols-1 row-cols-md-2 g-4">
        {% for poi in travel_info['pois'] %}
          <div class="col">
            <div class="card h-100 border-0 shadow-sm">
              <div class="row g-0 align-items-center">
                
                <!-- Left: Image -->
                <div class="col-auto">
                  <div class="bg-light d-flex align-items-center justify-content-center rounded"
                       style="width:110px; height:110px; overflow:hidden;">
                    {% if poi.image %}
                      <img src="{{ poi.image }}"
                           alt="{{ poi.name }}"
                           class="img-fluid"
                           style="width:110px; height:110px; object-fit:cover;">
                    {% else %}
                      <i class="bi bi-image text-muted" style="font-size:2rem;"></i>
                    {% endif %}
                  </div>
                </div>

                <!-- Right: Content -->
                <div class="col ps-3">
                  <h6 class="fw-semibold mb-1" style="line-height:1.3;">{{ poi.name }}</h6>

                  {% if poi.description %}
                    <p class="small text-muted mb-1" style="line-height:1.25;">
                      {{ poi.description[:180] ~ ('â€¦' if poi.description|length > 180 else '') }}
                    </p>
                  {% endif %}

                  {% if poi.lat and poi.lon %}
					  <div class="text-muted small">
						<a href="https://www.google.com/maps?q={{ poi.lat }},{{ poi.lon }}"
						   target="_blank"
						   rel="noopener"
						   class="text-decoration-none">
						  ğŸ“ Map
						</a>
					  </div>
					{% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endif %}
{% set has_coords = travel_info['pois'] | selectattr('lat') | list | length > 0 %}
{% if has_coords %}
  <div class="card shadow-sm mt-4">
    <div class="card-header text-primary fw-semibold">
      <i class="bi bi-map me-1"></i>
      {{ 'POI Map' if lang != 'he' else '××¤×ª × ×§×•×“×•×ª ×¢× ×™×™×Ÿ' }}
    </div>
    <div class="card-body p-0">
      <div id="poiMap" style="height: 400px;"></div>
    </div>
  </div>

  <!-- âœ… EMBED POI JSON SAFELY -->
  <script id="poi-data" type="application/json">
    {{ travel_info['pois'] | tojson(indent=0) | safe }}
  </script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const lang = "{{ lang or 'en' }}";
    const destinationCountry = "{{ destination.Country }}";

    const warningContainer = document.getElementById("warning-container");
    const warningMessage = document.getElementById("warning-message");

    const t_more = lang === "he" ? "××˜×” ×œ×‘×™×˜×—×•×Ÿ ×œ××•××™" : "National Security Council";
    const locale = lang === "he" ? "he-IL" : "en-US";

    // -------------------------------
    // Load travel warnings for country
    // -------------------------------
    async function showTravelWarnings(country) {
        try {
            const res = await fetch(`/api/warnings?country=${encodeURIComponent(country)}`);
            const data = await res.json();

            if (!data.warnings || data.warnings.length === 0) {
                warningContainer.classList.add("d-none");
                warningMessage.innerHTML = "";
                return;
            }

            const html = data.warnings.map(w => {
                const text = w.recommendations || "Missing Information.";
                const link = w.link
                    ? `<a href="${w.link}" target="_blank" rel="noopener noreferrer" class="ms-1 text-decoration-underline">[${t_more}]</a>`
                    : "";

                let dateHtml = "";
                if (w.date) {
                    const d = new Date(w.date);
                    if (!isNaN(d)) {
                        dateHtml = `<div class="text-muted small mt-1">${d.toLocaleDateString(locale, {
                            year: "numeric",
                            month: "long",
                            day: "numeric"
                        })}</div>`;
                    }
                }

                return `<p class="mb-2">${text}${link}${dateHtml}</p>`;
            }).join("");

            warningMessage.innerHTML = html;
            warningContainer.classList.remove("d-none");

        } catch (err) {
            console.error("âš ï¸ Travel warning fetch error:", err);
        }
    }

    // Auto-run for destination page
    if (destinationCountry) {
        showTravelWarnings(destinationCountry);
    }

});
</script>





  <script>
    function escapeHTML(str) {
      return String(str).replace(/[&<>"']/g, function (m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        }[m];
      });
    }

    window.addEventListener("load", () => {
      const map = L.map('poiMap');
      const rawJson = document.getElementById("poi-data").textContent;
      let pois = [];

      try {
        pois = JSON.parse(rawJson);
      } catch (e) {
        console.error("âŒ Failed to parse POI data:", e);
        return;
      }

      const markers = L.layerGroup();
      const bounds = [];

      pois.forEach(poi => {
        if (typeof poi.lat === 'number' && typeof poi.lon === 'number') {
          const latlng = [poi.lat, poi.lon];
          bounds.push(latlng);

          const marker = L.marker(latlng);
          let popup = poi.name ? `<strong>${escapeHTML(poi.name)}</strong>` : '';

          if (
            poi.description &&
            typeof poi.description === 'string' &&
            (!poi.name || !poi.description.startsWith(poi.name))
          ) {
            popup += `<br>${escapeHTML(poi.description)}`;
          }

          marker.bindPopup(popup);
          markers.addLayer(marker);
        }
      });

      markers.addTo(map);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      if (bounds.length) {
        map.fitBounds(bounds, { padding: [20, 20] });
      } else {
        map.setView([{{ destination.lat }}, {{ destination.lon }}], 12);
      }

      setTimeout(() => map.invalidateSize(), 200);
    });
  </script>
{% endif %}

    </div>
	<div class="card-footer text-start">
	  <a href="{{ '/' if lang != 'he' else '/?lang=he' }}"
		 class="btn btn-outline-primary">
		{% if lang == 'he' %}
		  ×—×–×¨×” ×œ×˜×‘×œ×” â†’
		{% else %}
		  â† Back to table
		{% endif %}
	  </a>
	</div>
  </div>
</div>
{% endblock %}

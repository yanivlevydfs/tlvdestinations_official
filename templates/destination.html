{% extends "base.html" %}
{% block head %}
<link rel="canonical" href="https://fly-tlv.com/destinations" />
<link rel="alternate" hreflang="en" href="https://fly-tlv.com/destinations" />
<link rel="alternate" hreflang="he" href="https://fly-tlv.com/destinations?lang=he" />
<link rel="stylesheet" href="{{ url_for('static', path='css/app.css') }}?v={{ time.time() }}">
  <!-- ✅ Page-specific SEO -->
  <meta name="description" content="Live flight statistics from Ben Gurion Airport (TLV). Explore the top destinations, airlines, countries, and cities with departures and arrivals updated in real-time.">
  <meta name="keywords" content="Ben Gurion Airport, TLV flights, flight statistics, top destinations, airlines, arrivals, departures, Tel Aviv flights">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Ben Gurion Airport — Current Flight Statistics | Fly-TLV">
  <meta property="og:description" content="See live statistics from Ben Gurion Airport (TLV). Explore top countries, cities, and airlines for departures and arrivals.">
  <meta property="og:url" content="https://fly-tlv.com/destinations">
  <meta property="og:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta property="og:image:alt" content="Ben Gurion Airport TLV statistics dashboard">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ben Gurion Airport — Current Flight Statistics | Fly-TLV">
  <meta name="twitter:description" content="Live departures and arrivals statistics from TLV airport. Updated charts with top destinations and airlines.">
  <meta name="twitter:image" content="https://fly-tlv.com/static/og/flytlv_og.jpg">
  <meta name="twitter:image:alt" content="TLV airport stats overview">

  <!-- Structured Data: Dataset -->
<script type="application/ld+json">
[
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Fly TLV — Worldwide Destinations",
    "url": "https://fly-tlv.com/",
    "inLanguage": "en-US",
    "description": "Explore all destinations worldwide from Tel Aviv (TLV) with airlines, maps, distances, and travel data."
  },
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Fly TLV — כל היעדים מתל אביב",
    "url": "https://fly-tlv.com/?lang=he",
    "inLanguage": "he-IL",
    "description": "גלה את כל היעדים בעולם מתל אביב (TLV): חברות תעופה, מפות, מרחקים ונתוני טיסה."
  },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Home", "url": "https://fly-tlv.com/" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "בית", "url": "https://fly-tlv.com/?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Stats", "url": "https://fly-tlv.com/stats" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "נתוני שדה", "url": "https://fly-tlv.com/stats?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Flights", "url": "https://fly-tlv.com/flights" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "טיסות", "url": "https://fly-tlv.com/flights?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "World Map", "url": "https://fly-tlv.com/map" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "מפת יעדים", "url": "https://fly-tlv.com/map?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Travel Warnings", "url": "https://fly-tlv.com/travel-warnings" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "אזהרות מסע", "url": "https://fly-tlv.com/travel-warnings?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Chat", "url": "https://fly-tlv.com/chat" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "צ׳אט", "url": "https://fly-tlv.com/chat?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "About", "url": "https://fly-tlv.com/about" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "עלינו", "url": "https://fly-tlv.com/about?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Direct vs Nonstop", "url": "https://fly-tlv.com/direct-vs-nonstop" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "ישיר מול ללא-עצירות", "url": "https://fly-tlv.com/direct-vs-nonstop?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Glossary", "url": "https://fly-tlv.com/glossary" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "מילון מונחים", "url": "https://fly-tlv.com/glossary?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Privacy Policy", "url": "https://fly-tlv.com/privacy" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "מדיניות פרטיות", "url": "https://fly-tlv.com/privacy?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Accessibility", "url": "https://fly-tlv.com/accessibility" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "נגישות", "url": "https://fly-tlv.com/accessibility?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Contact", "url": "https://fly-tlv.com/contact" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "צור קשר", "url": "https://fly-tlv.com/contact?lang=he" },

  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "Sitemap", "url": "https://fly-tlv.com/sitemap.xml" },
  { "@context": "https://schema.org", "@type": "SiteNavigationElement", "name": "מפת אתר", "url": "https://fly-tlv.com/sitemap.xml?lang=he" }
]
</script>
<style>
/* Light hover effect (unchanged) */
.hover-opacity:hover {
  background-color: #f8f9fa;
  box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.04);
  opacity: 0.9;
}
/* ✅ GLOBAL dark mode base */
body.dark-mode {
  color: #ffffff;
  background-color: #121212;
}

/* ✅ Fix card background and text */
body.dark-mode .card,
body.dark-mode .card-header,
body.dark-mode .card-footer,
body.dark-mode .card-body {
  background-color: #1e1e1e !important;
  color: #ffffff !important;
  border-color: #2c2c2c !important;
}

/* ✅ Force ALL inner text to white, including <p>, <strong>, <small>, etc. */
body.dark-mode .card *,
body.dark-mode .card-body *,
body.dark-mode .card-body p,
body.dark-mode .card-body small,
body.dark-mode .card-body .small,
body.dark-mode .card-body strong,
body.dark-mode .card-body span {
  color: #ffffff !important;
}

/* ✅ Muted text should still be dimmed, but not black */
body.dark-mode .card-body .text-muted {
  color: #b0b0b0 !important;
}

/* ✅ Fix background and text inside Wikipedia box */
body.dark-mode #city-overview,
body.dark-mode .bg-light {
  background-color: #2a2a2a !important;
  color: #ffffff !important;
}

/* ✅ Form elements */
body.dark-mode select.form-select,
body.dark-mode input,
body.dark-mode textarea {
  background-color: #2a2a2a !important;
  color: #ffffff !important;
  border-color: #444 !important;
}


</style>

{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-lg">
    <!-- Header -->
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h3 class="mb-0">
        ✈️ {{ destination.IATA }} — {{ destination.Name }}
      </h3>
		<span class="badge bg-light text-dark">
		  {{ destination.Country }}
		  {% if destination.CountryISO %}
			<img src="https://flagcdn.com/24x18/{{ destination.CountryISO | lower }}.png"
				 alt="{{ destination.Country }}" class="ms-1" />
		  {% endif %}
		</span>
    </div>

    <!-- Body -->
<div class="card-body">
  <!-- Compact Quick info grid -->
  <div class="row text-center mb-3">
    <div class="col-md-3">
      <i class="bi bi-geo-alt-fill text-danger" style="font-size: 1.3rem;"></i>
      <p class="mb-0 small"><strong>{{ destination.City }}</strong></p>
      <small class="text-muted">{{ 'City' if lang != 'he' else 'עיר' }}</small>
    </div>
    <div class="col-md-3">
      <i class="bi bi-signpost-split-fill text-success" style="font-size: 1.3rem;"></i>
      <p class="mb-0 small">{{ destination.IATA }}</p>
      <small class="text-muted">IATA</small>
    </div>
    <div class="col-md-3">
      <i class="bi bi-rulers text-primary" style="font-size: 1.3rem;"></i>
      <p class="mb-0 small">{{ "%.1f"|format(destination.Distance_km or 0) }} km</p>
      <small class="text-muted">{{ 'Distance' if lang != 'he' else 'מרחק' }}</small>
    </div>
    <div class="col-md-3">
      <i class="bi bi-clock-history text-warning" style="font-size: 1.3rem;"></i>
      <p class="mb-0 small">{{ destination.FlightTime_hr or "—" }}</p>
      <small class="text-muted">{{ 'Flight Time' if lang != 'he' else 'משך טיסה' }}</small>
    </div>
  </div>


      <!-- Coordinates -->
      <p>
        <strong>{{ 'Coordinates' if lang != 'he' else 'קואורדינטות' }}:</strong>
        {{ destination.lat }}, {{ destination.lon }}
      </p>

      <!-- Airlines -->
<h6 class="mt-4 mb-2 fw-semibold">
  <i class="bi bi-airplane-engines me-1 text-primary"></i>
  {{ 'Airlines' if lang != 'he' else 'חברות תעופה' }}:
</h6>

{% if destination.Airlines %}
  <div class="d-flex flex-wrap gap-2">
    {% for airline in destination.Airlines %}
      {% set airline_name = airline.strip().title() %}
      {% set website = AIRLINE_WEBSITES.get(airline_name) %}
      {% if website %}
        <a href="{{ website }}"
           target="_blank"
           rel="noopener"
           class="airline-chip text-decoration-none"
           style="transition: all 0.2s ease-in-out;"
           title="Visit {{ airline_name | e }} website">
          <span>{{ airline_name }}</span>
          <i class="bi bi-box-arrow-up-right ms-2 opacity-50"></i>
        </a>
      {% else %}
        <a href="https://www.google.com/search?q={{ airline_name | urlencode }}"
           target="_blank"
           rel="noopener"
           class="airline-chip text-decoration-none"
           style="transition: all 0.2s ease-in-out;"
           title="Search for {{ airline_name | e }} on Google">
          <span>{{ airline_name }}</span>
          <i class="bi bi-search ms-2 opacity-50"></i>
        </a>
      {% endif %}
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">—</p>
{% endif %}


      <!-- Wikipedia City Overview -->
      <div class="mt-5">
        <h5><i class="bi bi-info-circle"></i>
          {{ 'About ' ~ destination.City if lang != 'he' else 'על ' ~ destination.City }}
        </h5>
        <div id="city-overview" class="border rounded p-3 bg-light">
          {{ 'Loading city info...' if lang != 'he' else 'טוען מידע על העיר...' }}
        </div>
      </div>

      <!-- Map -->
	{% if destination.lat and destination.lon %}
	  <div class="mt-4">
		<h5>
		  <i class="bi bi-map"></i>
		  {{ 'Location Map' if lang != 'he' else 'מפת יעד' }}
		</h5>
		<iframe
		  width="100%"
		  height="350"
		  frameborder="0"
		  style="border:0; border-radius: 0.5rem;"
		  src="https://www.openstreetmap.org/export/embed.html?bbox={{ destination.lon | float - 0.5 }}%2C{{ destination.lat | float - 0.5 }}%2C{{ destination.lon | float + 0.5 }}%2C{{ destination.lat | float + 0.5 }}&layer=mapnik&marker={{ destination.lat }}%2C{{ destination.lon }}"
		  allowfullscreen
		  loading="lazy"
		  referrerpolicy="no-referrer"
		  aria-label="Map showing location of destination"
		></iframe>
	  </div>
	{% endif %}
    </div>
	<div class="card-footer text-start">
	  <a href="/" class="btn btn-outline-primary">
		← {{ 'Back to table' if lang != 'he' else 'חזרה לטבלה' }}
	  </a>
	</div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const city = "{{ destination.City|urlencode }}";
  const lang = "{{ 'he' if lang == 'he' else 'en' }}";
  const url  = `https://${lang}.wikipedia.org/api/rest_v1/page/summary/${city}`;

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Wiki not found");
    const data = await res.json();

    const box = document.getElementById("city-overview");
    let html = "";

    if (data.thumbnail) {
      html += `<img src="${data.thumbnail.source}" 
                  alt="${data.title}" 
                  class="float-start me-3 mb-2 rounded shadow-sm" 
                  style="max-width:180px;">`;
    }

    html += `<strong>${data.title}</strong><br>`;
    if (data.description) {
      html += `<em>${data.description}</em><br>`;
    }
    html += `<p>${data.extract}</p>`;

    box.innerHTML = html;
  } catch (err) {
    document.getElementById("city-overview").innerHTML =
      "{{ 'No Wikipedia data found.' if lang != 'he' else 'לא נמצא מידע בוויקיפדיה.' }}";
    console.error(err);
  }
});
</script>

{% endblock %}
